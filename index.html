<!DOCTYPE html>
<html lang="en-US">
<head>
  <meta charset="utf-8">
  <meta name="generator" content="pandoc">
  <meta name="author" content="Scott Windsor">
  <title>Let’s go Nix</title>
  <meta name="apple-mobile-web-app-capable" content="yes">
  <meta name="apple-mobile-web-app-status-bar-style" content="black-translucent">
  <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no, minimal-ui">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/reset.css">
  <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/reveal.css">
  <style>
    .reveal .sourceCode {  /* see #7635 */
      overflow: visible;
    }
    code{white-space: pre-wrap;}
    span.smallcaps{font-variant: small-caps;}
    div.columns{display: flex; gap: min(4vw, 1.5em);}
    div.column{flex: auto; overflow-x: auto;}
    div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
    /* The extra [class] is a hack that increases specificity enough to
       override a similar rule in reveal.js */
    ul.task-list[class]{list-style: none;}
    ul.task-list li input[type="checkbox"] {
      font-size: inherit;
      width: 0.8em;
      margin: 0 0.8em 0.2em -1.6em;
      vertical-align: middle;
    }
    .display.math{display: block; text-align: center; margin: 0.5rem auto;}
    /* CSS for syntax highlighting */
    html { -webkit-text-size-adjust: 100%; }
    pre > code.sourceCode { white-space: pre; position: relative; }
    pre > code.sourceCode > span { display: inline-block; line-height: 1.25; }
    pre > code.sourceCode > span:empty { height: 1.2em; }
    .sourceCode { overflow: visible; }
    code.sourceCode > span { color: inherit; text-decoration: inherit; }
    div.sourceCode { margin: 1em 0; }
    pre.sourceCode { margin: 0; }
    @media screen {
    div.sourceCode { overflow: auto; }
    }
    @media print {
    pre > code.sourceCode { white-space: pre-wrap; }
    pre > code.sourceCode > span { text-indent: -5em; padding-left: 5em; }
    }
    pre.numberSource code
      { counter-reset: source-line 0; }
    pre.numberSource code > span
      { position: relative; left: -4em; counter-increment: source-line; }
    pre.numberSource code > span > a:first-child::before
      { content: counter(source-line);
        position: relative; left: -1em; text-align: right; vertical-align: baseline;
        border: none; display: inline-block;
        -webkit-touch-callout: none; -webkit-user-select: none;
        -khtml-user-select: none; -moz-user-select: none;
        -ms-user-select: none; user-select: none;
        padding: 0 4px; width: 4em;
      }
    pre.numberSource { margin-left: 3em;  padding-left: 4px; }
    div.sourceCode
      { color: #a9b1d6;  }
    @media screen {
    pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
    }
    code span { color: #a9b1d6; } /* Normal */
    code span.al { color: #ff9e64; background-color: #414868; font-weight: bold; } /* Alert */
    code span.an { color: #6a75a8; } /* Annotation */
    code span.at { color: #bb9af7; } /* Attribute */
    code span.bn { color: #ff9e64; } /* BaseN */
    code span.bu { color: #9aa5ce; } /* BuiltIn */
    code span.cf { color: #bb9af7; } /* ControlFlow */
    code span.ch { color: #9ece6a; } /* Char */
    code span.cn { color: #ff9e64; } /* Constant */
    code span.co { color: #565f89; } /* Comment */
    code span.cv { color: #bb9af7; } /* CommentVar */
    code span.do { color: #5a638c; } /* Documentation */
    code span.dt { color: #bb9af7; } /* DataType */
    code span.dv { color: #ff9e64; } /* DecVal */
    code span.er { color: #db4b4b; } /* Error */
    code span.ex { color: #73daca; } /* Extension */
    code span.fl { color: #ff9e64; } /* Float */
    code span.fu { color: #7aa2f7; } /* Function */
    code span.im { color: #7dcfff; } /* Import */
    code span.in { color: #6a75a8; } /* Information */
    code span.kw { color: #bb9af7; } /* Keyword */
    code span.op { color: #bb9af7; } /* Operator */
    code span.ot { color: #f7768e; } /* Other */
    code span.pp { color: #bb9af7; } /* Preprocessor */
    code span.re { color: #a9b1d6; background-color: #414868; } /* RegionMarker */
    code span.sc { color: #7dcfff; } /* SpecialChar */
    code span.ss { color: #b4f9f8; } /* SpecialString */
    code span.st { color: #9ece6a; } /* String */
    code span.va { color: #c0caf5; } /* Variable */
    code span.vs { color: #e0af68; } /* VerbatimString */
    code span.wa { color: #c49a5a; } /* Warning */
  </style>
  <link rel="stylesheet" href="https://unpkg.com/reveal.js/dist/theme/moon.css" id="theme">
  <style>
  .slides {
    font-size: medium;
    h2 {
      text-align: left;
    }
  }
  .reveal ul {
      display: block;
      margin-bottom: 1.25em;
  }
  .reveal ol {
      display: block;
  }
  .reveal code.sourceCode {
      font-size: medium;
      overflow: auto;
      text-wrap: wrap;
  }

  img {
      max-height: 350px !important;
  }

  figcaption {
      font-size: 0.6em !important;
      font-style: italic !important;
  }

  .subtitle {
      font-style: italic !important;
  }

  .date {
      font-size: 0.75em !important;
  }
  </style>
</head>
<body>
  <div class="reveal">
    <div class="slides">

<section id="title-slide" data-background-image="img/nix-snowflake-rainbow.png" data-background-size="contain">
  <h1 class="title">Let’s go Nix</h1>
  <p class="author">Scott Windsor</p>
  <p class="institute">Devops PDX</p>
</section>

<section class="slide level1">

<h3 id="goals">Goals</h3>
<ul>
<li>Beginner-friendly intro to nix</li>
<li>Introduce concepts and language</li>
<li>Get you excited about nix!</li>
</ul>
<h3 id="expectations">Expectations</h3>
<ul>
<li>Familiarity with command line &amp; shell</li>
<li>Understand at least one programming language like
<code>javascript</code></li>
</ul>
</section>
<section class="slide level1">

<h2 id="background">Background</h2>
<ul>
<li>Been a developer for &gt; 20 years</li>
<li>Dealt with countless build/run dependency issues</li>
<li>Have worked heavily with modernizing legacy systems</li>
<li>Usually work in small agile teams</li>
</ul>
<aside class="notes">
<p>A bit about me and why I care so much about this problem.</p>
</aside>
</section>
<section id="the-quest-for-reproducible-development-environments"
class="slide level1">
<h1>The Quest for Reproducible Development Environments</h1>
<ul>
<li>automake (and porting)</li>
<li>ports / macports</li>
<li>anisible</li>
<li>chef</li>
<li>puppet</li>
<li>Language managers: (rvm, virtualenv, nvm)</li>
<li>Docker</li>
</ul>
<aside class="notes">
<p>I’ve tried a lot of different tools to solve these problems. They’ve
all had different drawbacks. Either they don’t really work for all
environments, they rely on virtualization, or they solve the problem for
one specific language.</p>
</aside>
</section>
<section id="but-they-always-fall-short" class="slide level1">
<h1>But they always fall short</h1>
<ul>
<li>System architecture woes (again!)</li>
<li>Personal machine drift</li>
<li>Working with multiple projects across teams</li>
</ul>
<aside class="notes">
<p>These tools are great but they fall short of solving the problem all
of the way. Intel vs Apple Silicon Mac vs Linux DLL-hell? Apps fighting
over libxml or openssl issues? Things going sideways after OS upgrade
(or worse inconsistent between developers?)</p>
</aside>
</section>
<section id="how-nix-is-different" class="slide level1">
<h1>How Nix is different</h1>
<ul>
<li>Saves packages in isolation - <code>/nix/store</code></li>
<li>Builds packages with a functional language</li>
<li>Allows you to link to system, user, or shell environments these
packages</li>
</ul>
<aside class="notes">
<p>nix has a very different way for solving this problem. It provides a
store for conten adressable packages defined in a functional language.
This allows you</p>
</aside>
</section>
<section id="first-steps---installing" class="slide level1">
<h1>First steps - installing</h1>
<div class="sourceCode" id="cb1"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb1-1"><a href="#cb1-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> curl <span class="at">-fsSL</span> https://install.determinate.systems/nix <span class="kw">|</span> <span class="fu">sh</span> <span class="at">-s</span> <span class="at">--</span> install <span class="at">--determinate</span></span></code></pre></div>
<aside class="notes">
<p>We’re going to walk through setting everything up one step at a time.
I don’t expect you to follow-along real-time, but you can go through
these slides later if you want The goal is to learn how these things
work together. We’re using determinate nix here, which is a distribution
of nix that makes it easier to use.</p>
</aside>
</section>
<section id="creating-shell-with-curl" class="slide level1">
<h1>Creating shell with curl</h1>
<div class="sourceCode" id="cb2"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb2-1"><a href="#cb2-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix-shell <span class="at">-p</span> curl</span>
<span id="cb2-2"><a href="#cb2-2" aria-hidden="true" tabindex="-1"></a><span class="ex">these</span> 9 paths will be fetched <span class="er">(</span><span class="ex">0.99</span> MiB download, 4.14 MiB unpacked<span class="kw">)</span><span class="bu">:</span></span>
<span id="cb2-3"><a href="#cb2-3" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/9v2s5rbf6pb77vhagihl7dicpqkg3614-c-ares-1.34.5</span></span>
<span id="cb2-4"><a href="#cb2-4" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/wznrhnlrvamvihizpnizjfh5hs55z98n-curl-8.14.1-dev</span></span>
<span id="cb2-5"><a href="#cb2-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/48wm9h7wf8ds4wkwgzzcqfrp7l722dm8-krb5-1.21.3-dev</span></span>
<span id="cb2-6"><a href="#cb2-6" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/i1j8dzchkv1p59bqzrr15585s8s4zvx0-libev-4.33</span></span>
<span id="cb2-7"><a href="#cb2-7" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/kss6l466kl66x2bqzy9rv7nz4pjgc55c-libidn2-2.3.8-bin</span></span>
<span id="cb2-8"><a href="#cb2-8" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/9j67k582x3vgcijfiyralx5bj1b33gdg-libidn2-2.3.8-dev</span></span>
<span id="cb2-9"><a href="#cb2-9" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/y37r7yjyvnzzd648lpdgflynfj55hpns-libpsl-0.21.5-dev</span></span>
<span id="cb2-10"><a href="#cb2-10" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/rq4pnjcjrkic79kxc2fq0g7hp78s8ypv-nghttp2-1.65.0</span></span>
<span id="cb2-11"><a href="#cb2-11" aria-hidden="true" tabindex="-1"></a>  <span class="ex">/nix/store/9pn6y4zlszr9w26rg2h52l3sd0wvzjvd-nghttp2-1.65.0-dev</span></span>
<span id="cb2-12"><a href="#cb2-12" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/48wm9h7wf8ds4wkwgzzcqfrp7l722dm8-krb5-1.21.3-dev&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-13"><a href="#cb2-13" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/9v2s5rbf6pb77vhagihl7dicpqkg3614-c-ares-1.34.5&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-14"><a href="#cb2-14" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/y37r7yjyvnzzd648lpdgflynfj55hpns-libpsl-0.21.5-dev&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-15"><a href="#cb2-15" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/kss6l466kl66x2bqzy9rv7nz4pjgc55c-libidn2-2.3.8-bin&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-16"><a href="#cb2-16" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/i1j8dzchkv1p59bqzrr15585s8s4zvx0-libev-4.33&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-17"><a href="#cb2-17" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/9j67k582x3vgcijfiyralx5bj1b33gdg-libidn2-2.3.8-dev&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-18"><a href="#cb2-18" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/rq4pnjcjrkic79kxc2fq0g7hp78s8ypv-nghttp2-1.65.0&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-19"><a href="#cb2-19" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/9pn6y4zlszr9w26rg2h52l3sd0wvzjvd-nghttp2-1.65.0-dev&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span>
<span id="cb2-20"><a href="#cb2-20" aria-hidden="true" tabindex="-1"></a><span class="ex">copying</span> path <span class="st">&#39;/nix/store/wznrhnlrvamvihizpnizjfh5hs55z98n-curl-8.14.1-dev&#39;</span> from <span class="st">&#39;https://cache.nixos.org&#39;</span>...</span></code></pre></div>
<aside class="notes">
<p>We can use <code>nix-shell</code> to create a temporary shell with
curl installed. Note the dependencies required and they they are
content-addressable and versioned. Also note that means they be
downloaded.</p>
</aside>
</section>
<section id="creating-shell-with-curl-1" class="slide level1">
<h1>Creating shell with curl</h1>
<div class="sourceCode" id="cb3"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb3-1"><a href="#cb3-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[nix-shell:~/workspace/nix-talk]$</span> curl <span class="at">--version</span></span>
<span id="cb3-2"><a href="#cb3-2" aria-hidden="true" tabindex="-1"></a><span class="ex">curl</span> 8.14.1 <span class="er">(</span><span class="ex">x86_64-pc-linux-gnu</span><span class="kw">)</span> <span class="ex">libcurl/8.14.1</span> OpenSSL/3.4.1 zlib/1.3.1 brotli/1.1.0 zstd/1.5.7 libidn2/2.3.8 libpsl/0.21.5 libssh2/1.11.1 nghttp2/1.65.0</span>
<span id="cb3-3"><a href="#cb3-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Release-Date:</span> 2025-06-04</span>
<span id="cb3-4"><a href="#cb3-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Protocols:</span> dict file ftp ftps gopher gophers http https imap imaps ipfs ipns mqtt pop3 pop3s rtsp scp sftp smb smbs smtp smtps telnet tftp</span>
<span id="cb3-5"><a href="#cb3-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Features:</span> alt-svc AsynchDNS brotli GSS-API HSTS HTTP2 HTTPS-proxy IDN IPv6 Kerberos Largefile libz NTLM PSL SPNEGO SSL threadsafe TLS-SRP UnixSockets zstd</span>
<span id="cb3-6"><a href="#cb3-6" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb3-7"><a href="#cb3-7" aria-hidden="true" tabindex="-1"></a><span class="ex">[nix-shell:~/workspace/nix-talk]$</span> which curl</span>
<span id="cb3-8"><a href="#cb3-8" aria-hidden="true" tabindex="-1"></a><span class="ex">/nix/store/wq4mwdypl1wmlhyrr69wggv8jdn2h9j9-curl-8.14.1-bin/bin/curl</span></span></code></pre></div>
<aside class="notes">
<p>We can see that it works for us and what features are enabled. We can
also see where this version is built in the store.</p>
</aside>
</section>
<section id="showing-runtime-dependencies-linux" class="slide level1">
<h1>Showing runtime dependencies (Linux)</h1>
<div class="sourceCode" id="cb4"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb4-1"><a href="#cb4-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[nix-shell:~/workspace/nix-talk]$</span> ldd <span class="va">$(</span><span class="fu">which</span> curl<span class="va">)</span></span>
<span id="cb4-2"><a href="#cb4-2" aria-hidden="true" tabindex="-1"></a>        <span class="ex">linux-vdso.so.1</span> <span class="er">(</span><span class="ex">0x00007f0e95cfa000</span><span class="kw">)</span></span>
<span id="cb4-3"><a href="#cb4-3" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libcurl.so.4</span> =<span class="op">&gt;</span> /nix/store/frlckg2m2sf0gs8g5pqkryddbpy6qcz1-curl-8.14.1/lib/libcurl.so.4 <span class="er">(</span><span class="ex">0x00007f0e95c12000</span><span class="kw">)</span></span>
<span id="cb4-4"><a href="#cb4-4" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libnghttp2.so.14</span> =<span class="op">&gt;</span> /nix/store/gwwbjkdd3rghq7x74561agq08f4jmh7p-nghttp2-1.65.0-lib/lib/libnghttp2.so.14 <span class="er">(</span><span class="ex">0x00007f0e95be3000</span><span class="kw">)</span></span>
<span id="cb4-5"><a href="#cb4-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libidn2.so.0</span> =<span class="op">&gt;</span> /nix/store/ncdwsrgq6n6161l433m4x34057zq0hhf-libidn2-2.3.8/lib/libidn2.so.0 <span class="er">(</span><span class="ex">0x00007f0e95bb2000</span><span class="kw">)</span></span>
<span id="cb4-6"><a href="#cb4-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libssh2.so.1</span> =<span class="op">&gt;</span> /nix/store/y6w3rwlym1mlpcysn6l7r5vbdmf9irf1-libssh2-1.11.1/lib/libssh2.so.1 <span class="er">(</span><span class="ex">0x00007f0e95b67000</span><span class="kw">)</span></span>
<span id="cb4-7"><a href="#cb4-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libpsl.so.5</span> =<span class="op">&gt;</span> /nix/store/31fknicrbimbw6ivnxly9pdabsqqglk5-libpsl-0.21.5/lib/libpsl.so.5 <span class="er">(</span><span class="ex">0x00007f0e95b53000</span><span class="kw">)</span></span>
<span id="cb4-8"><a href="#cb4-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libssl.so.3</span> =<span class="op">&gt;</span> /nix/store/byx7ahs386pskh8d5sdkrkpscfz9yyjp-openssl-3.4.1/lib/libssl.so.3 <span class="er">(</span><span class="ex">0x00007f0e95a47000</span><span class="kw">)</span></span>
<span id="cb4-9"><a href="#cb4-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libcrypto.so.3</span> =<span class="op">&gt;</span> /nix/store/byx7ahs386pskh8d5sdkrkpscfz9yyjp-openssl-3.4.1/lib/libcrypto.so.3 <span class="er">(</span><span class="ex">0x00007f0e95400000</span><span class="kw">)</span></span>
<span id="cb4-10"><a href="#cb4-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libgssapi_krb5.so.2</span> =<span class="op">&gt;</span> /nix/store/ppxfllzvl2b03x4ahqkyf6v6hiqf0hix-krb5-1.21.3-lib/lib/libgssapi_krb5.so.2 <span class="er">(</span><span class="ex">0x00007f0e959f1000</span><span class="kw">)</span></span>
<span id="cb4-11"><a href="#cb4-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libzstd.so.1</span> =<span class="op">&gt;</span> /nix/store/and18rawgmwws8l2favbjr5wm31jnr4a-zstd-1.5.7/lib/libzstd.so.1 <span class="er">(</span><span class="ex">0x00007f0e95327000</span><span class="kw">)</span></span>
<span id="cb4-12"><a href="#cb4-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libbrotlidec.so.1</span> =<span class="op">&gt;</span> /nix/store/czrad292gq5adw7kjj0z71gkw48mnmim-brotli-1.1.0-lib/lib/libbrotlidec.so.1 <span class="er">(</span><span class="ex">0x00007f0e959e0000</span><span class="kw">)</span></span>
<span id="cb4-13"><a href="#cb4-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libz.so.1</span> =<span class="op">&gt;</span> /nix/store/vx438ll7xvv9q5ns8mqpphsg2dxg9yi9-zlib-1.3.1/lib/libz.so.1 <span class="er">(</span><span class="ex">0x00007f0e959c2000</span><span class="kw">)</span></span>
<span id="cb4-14"><a href="#cb4-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libc.so.6</span> =<span class="op">&gt;</span> /nix/store/q4wq65gl3r8fy746v9bbwgx4gzn0r2kl-glibc-2.40-66/lib/libc.so.6 <span class="er">(</span><span class="ex">0x00007f0e95000000</span><span class="kw">)</span></span>
<span id="cb4-15"><a href="#cb4-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libunistring.so.5</span> =<span class="op">&gt;</span> /nix/store/vm18dxfa5v7y3linrg1x1q9wx41bkxwf-libunistring-1.3/lib/libunistring.so.5 <span class="er">(</span><span class="ex">0x00007f0e94e15000</span><span class="kw">)</span></span>
<span id="cb4-16"><a href="#cb4-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libdl.so.2</span> =<span class="op">&gt;</span> /nix/store/q4wq65gl3r8fy746v9bbwgx4gzn0r2kl-glibc-2.40-66/lib/libdl.so.2 <span class="er">(</span><span class="ex">0x00007f0e959bb000</span><span class="kw">)</span></span>
<span id="cb4-17"><a href="#cb4-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libpthread.so.0</span> =<span class="op">&gt;</span> /nix/store/q4wq65gl3r8fy746v9bbwgx4gzn0r2kl-glibc-2.40-66/lib/libpthread.so.0 <span class="er">(</span><span class="ex">0x00007f0e959b6000</span><span class="kw">)</span></span>
<span id="cb4-18"><a href="#cb4-18" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libkrb5.so.3</span> =<span class="op">&gt;</span> /nix/store/ppxfllzvl2b03x4ahqkyf6v6hiqf0hix-krb5-1.21.3-lib/lib/libkrb5.so.3 <span class="er">(</span><span class="ex">0x00007f0e9524d000</span><span class="kw">)</span></span>
<span id="cb4-19"><a href="#cb4-19" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libk5crypto.so.3</span> =<span class="op">&gt;</span> /nix/store/ppxfllzvl2b03x4ahqkyf6v6hiqf0hix-krb5-1.21.3-lib/lib/libk5crypto.so.3 <span class="er">(</span><span class="ex">0x00007f0e9521d000</span><span class="kw">)</span></span>
<span id="cb4-20"><a href="#cb4-20" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libcom_err.so.3</span> =<span class="op">&gt;</span> /nix/store/ppxfllzvl2b03x4ahqkyf6v6hiqf0hix-krb5-1.21.3-lib/lib/libcom_err.so.3 <span class="er">(</span><span class="ex">0x00007f0e959ad000</span><span class="kw">)</span></span>
<span id="cb4-21"><a href="#cb4-21" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libkrb5support.so.0</span> =<span class="op">&gt;</span> /nix/store/ppxfllzvl2b03x4ahqkyf6v6hiqf0hix-krb5-1.21.3-lib/lib/libkrb5support.so.0 <span class="er">(</span><span class="ex">0x00007f0e9520f000</span><span class="kw">)</span></span>
<span id="cb4-22"><a href="#cb4-22" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libkeyutils.so.1</span> =<span class="op">&gt;</span> /nix/store/6k8218bcmnknl7vq07vmm33b33i35586-keyutils-1.6.3-lib/lib/libkeyutils.so.1 <span class="er">(</span><span class="ex">0x00007f0e94e0e000</span><span class="kw">)</span></span>
<span id="cb4-23"><a href="#cb4-23" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libresolv.so.2</span> =<span class="op">&gt;</span> /nix/store/q4wq65gl3r8fy746v9bbwgx4gzn0r2kl-glibc-2.40-66/lib/libresolv.so.2 <span class="er">(</span><span class="ex">0x00007f0e94dfb000</span><span class="kw">)</span></span>
<span id="cb4-24"><a href="#cb4-24" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libm.so.6</span> =<span class="op">&gt;</span> /nix/store/q4wq65gl3r8fy746v9bbwgx4gzn0r2kl-glibc-2.40-66/lib/libm.so.6 <span class="er">(</span><span class="ex">0x00007f0e94d13000</span><span class="kw">)</span></span>
<span id="cb4-25"><a href="#cb4-25" aria-hidden="true" tabindex="-1"></a>        <span class="ex">libbrotlicommon.so.1</span> =<span class="op">&gt;</span> /nix/store/czrad292gq5adw7kjj0z71gkw48mnmim-brotli-1.1.0-lib/lib/libbrotlicommon.so.1 <span class="er">(</span><span class="ex">0x00007f0e94cf0000</span><span class="kw">)</span></span>
<span id="cb4-26"><a href="#cb4-26" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/q4wq65gl3r8fy746v9bbwgx4gzn0r2kl-glibc-2.40-66/lib/ld-linux-x86-64.so.2</span> =<span class="op">&gt;</span> /nix/store/q4wq65gl3r8fy746v9bbwgx4gzn0r2kl-glibc-2.40-66/lib64/ld-linux-x86-64.so.2 <span class="er">(</span><span class="ex">0x00007f0e95cfc000</span><span class="kw">)</span></span></code></pre></div>
<aside class="notes">
<p>Even better, we can use ldd to see what shared objects curl uses</p>
</aside>
</section>
<section id="showing-runtime-dependencies-macos" class="slide level1">
<h1>Showing runtime dependencies (macOS)</h1>
<div class="sourceCode" id="cb5"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb5-1"><a href="#cb5-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[nix-shell:~]$</span> otool <span class="at">-L</span> <span class="va">$(</span><span class="fu">which</span> curl<span class="va">)</span></span>
<span id="cb5-2"><a href="#cb5-2" aria-hidden="true" tabindex="-1"></a><span class="ex">/nix/store/bblr8ccnd4baxm4cf7g1igfz6ya8v93m-curl-8.14.1-bin/bin/curl:</span></span>
<span id="cb5-3"><a href="#cb5-3" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/6l3i3d58xr1r4qv49v1ln8wf309sb15x-curl-8.14.1/lib/libcurl.4.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 13.0.0, current version 13.0.0<span class="kw">)</span></span>
<span id="cb5-4"><a href="#cb5-4" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/jkdx2fgyj2lhma8xydrp6xkqgv13a00g-nghttp2-1.65.0-lib/lib/libnghttp2.14.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 43.0.0, current version 43.4.0<span class="kw">)</span></span>
<span id="cb5-5"><a href="#cb5-5" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/8jfck34h4ayxg41lylz1aayjjjmy2qhw-libidn2-2.3.8/lib/libidn2.0.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 5.0.0, current version 5.0.0<span class="kw">)</span></span>
<span id="cb5-6"><a href="#cb5-6" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/4kk9xgcdga33k9h371p81svlam1aqa07-libssh2-1.11.1/lib/libssh2.1.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 2.0.0, current version 2.1.0<span class="kw">)</span></span>
<span id="cb5-7"><a href="#cb5-7" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/lvg9zfb2ig76821dmmpcdlb9xd6md1g5-libpsl-0.21.5/lib/libpsl.5.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 9.0.0, current version 9.5.0<span class="kw">)</span></span>
<span id="cb5-8"><a href="#cb5-8" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/7fqm5r0kdy21fdblcl1x4zm63wl12bjj-openssl-3.4.1/lib/libssl.3.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 3.0.0, current version 3.0.0<span class="kw">)</span></span>
<span id="cb5-9"><a href="#cb5-9" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/7fqm5r0kdy21fdblcl1x4zm63wl12bjj-openssl-3.4.1/lib/libcrypto.3.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 3.0.0, current version 3.0.0<span class="kw">)</span></span>
<span id="cb5-10"><a href="#cb5-10" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/xvrbzp3i5s00paykwcrf032bnddvf4fa-krb5-1.21.3-lib/lib/libgssapi_krb5.2.2.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 2.0.0, current version 2.2.0<span class="kw">)</span></span>
<span id="cb5-11"><a href="#cb5-11" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/ml7rlz2qfk7dpkg02af2gx7x97wzckcg-libresolv-83/lib/libresolv.9.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 1.0.0, current version 1.0.0<span class="kw">)</span></span>
<span id="cb5-12"><a href="#cb5-12" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/jy938j9d6pnrwwbs3s16mrxnsikj564k-zstd-1.5.7/lib/libzstd.1.5.7.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 1.0.0, current version 1.5.7<span class="kw">)</span></span>
<span id="cb5-13"><a href="#cb5-13" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/0xc8g1l0wxzipdfwqpj5ax5nzjj751b1-brotli-1.1.0-lib/lib/libbrotlidec.1.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 1.0.0, current version 1.1.0<span class="kw">)</span></span>
<span id="cb5-14"><a href="#cb5-14" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/nix/store/fr590df7m2v4521ybwa4k8hddwprf01y-zlib-1.3.1/lib/libz.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 1.0.0, current version 1.3.1<span class="kw">)</span></span>
<span id="cb5-15"><a href="#cb5-15" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/System/Library/Frameworks/SystemConfiguration.framework/Versions/A/SystemConfiguration</span> <span class="er">(</span><span class="ex">compatibility</span> version 1.0.0, current version 1109.101.1<span class="kw">)</span></span>
<span id="cb5-16"><a href="#cb5-16" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/System/Library/Frameworks/CoreServices.framework/Versions/A/CoreServices</span> <span class="er">(</span><span class="ex">compatibility</span> version 1.0.0, current version 1122.33.0<span class="kw">)</span></span>
<span id="cb5-17"><a href="#cb5-17" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/System/Library/Frameworks/CoreFoundation.framework/Versions/A/CoreFoundation</span> <span class="er">(</span><span class="ex">compatibility</span> version 150.0.0, current version 1775.118.101<span class="kw">)</span></span>
<span id="cb5-18"><a href="#cb5-18" aria-hidden="true" tabindex="-1"></a>        <span class="ex">/usr/lib/libSystem.B.dylib</span> <span class="er">(</span><span class="ex">compatibility</span> version 1.0.0, current version 1292.100.5<span class="kw">)</span></span></code></pre></div>
<aside class="notes">
<p>The macOS version works the same but looks a bit different. Note here
it relies on some macOS system dependencies.</p>
</aside>
</section>
<section id="how-nix-is-different-1" class="slide level1">
<h1>How nix is different</h1>
<div class="sourceCode" id="cb6"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb6-1"><a href="#cb6-1" aria-hidden="true" tabindex="-1"></a><span class="ex">[nix-shell:~/workspace/nix-talk]$</span> exit </span>
<span id="cb6-2"><a href="#cb6-2" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span></code></pre></div>
<aside class="notes">
<p>And we can exit the shell when we’re done. The package is still built
(until garbage collected), but no longer in your shell.</p>
</aside>
</section>
<section id="your-first-environment" class="slide level1">
<h1>Your first environment</h1>
<div class="sourceCode" id="cb7"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb7-1"><a href="#cb7-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> mkdir <span class="at">-p</span> ~/workspace/nix-firs-steps</span>
<span id="cb7-2"><a href="#cb7-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/workspace/nix-first-steps</span>
<span id="cb7-3"><a href="#cb7-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git init</span>
<span id="cb7-4"><a href="#cb7-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix flake init templates#utils-generic</span></code></pre></div>
<aside class="notes">
<p>First let’s make a git repo and initialize our “flake” A flake is way
to version-pin dependencies and structure nix environments While it’s
“experimental”, it’s on by default for determinate and the preferred
approach when using nix for environments.</p>
</aside>
</section>
<section id="your-first-environment-1" class="slide level1">
<h1>Your first environment</h1>
<p><code>flake.nix</code>:</p>
<div class="sourceCode" id="cb8"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb8-1"><a href="#cb8-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb8-2"><a href="#cb8-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">inputs</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb8-3"><a href="#cb8-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">utils</span>.<span class="va">url</span> <span class="op">=</span> <span class="st">&quot;github:numtide/flake-utils&quot;</span><span class="op">;</span></span>
<span id="cb8-4"><a href="#cb8-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb8-5"><a href="#cb8-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">outputs</span> <span class="op">=</span> <span class="op">{</span> <span class="va">self</span><span class="op">,</span> <span class="va">nixpkgs</span><span class="op">,</span> <span class="va">utils</span> <span class="op">}</span>: utils<span class="op">.</span>lib<span class="op">.</span>eachDefaultSystem <span class="op">(</span><span class="va">system</span><span class="op">:</span></span>
<span id="cb8-6"><a href="#cb8-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb8-7"><a href="#cb8-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">pkgs</span> <span class="op">=</span> nixpkgs<span class="op">.</span>legacyPackages<span class="op">.</span><span class="sc">${</span>system<span class="sc">}</span><span class="op">;</span></span>
<span id="cb8-8"><a href="#cb8-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">in</span></span>
<span id="cb8-9"><a href="#cb8-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb8-10"><a href="#cb8-10" aria-hidden="true" tabindex="-1"></a>      <span class="va">devShell</span> <span class="op">=</span> pkgs<span class="op">.</span>mkShell <span class="op">{</span></span>
<span id="cb8-11"><a href="#cb8-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">buildInputs</span> <span class="op">=</span> <span class="kw">with</span> pkgs<span class="op">;</span> <span class="op">[</span></span>
<span id="cb8-12"><a href="#cb8-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">];</span></span>
<span id="cb8-13"><a href="#cb8-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">};</span></span>
<span id="cb8-14"><a href="#cb8-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb8-15"><a href="#cb8-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">);</span></span>
<span id="cb8-16"><a href="#cb8-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>This is our flake configuration. Don’t worry that you don’t
understand this yet, we’ll learn what this all means soon.</p>
</aside>
</section>
<section id="your-first-environment-2" class="slide level1">
<h1>Your first environment</h1>
<p><code>.envrc</code>:</p>
<div class="sourceCode" id="cb9"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb9-1"><a href="#cb9-1" aria-hidden="true" tabindex="-1"></a><span class="ex">use</span> flake</span></code></pre></div>
<aside class="notes">
<p>This also adds an envrc that uses our flake. direnv, which we’ll
install later, will use this to load our dev shell.</p>
</aside>
</section>
<section id="nix-the-language" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb10"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb10-1"><a href="#cb10-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Text that follows a `#` is a comment!</span></span></code></pre></div>
<aside class="notes">
<p>Let’s take some time to learn nix (the language) Comments start with
Hashes (Octothorpes)</p>
</aside>
</section>
<section id="nix-the-language-1" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb11"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb11-1"><a href="#cb11-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a string</span></span>
<span id="cb11-2"><a href="#cb11-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb11-3"><a href="#cb11-3" aria-hidden="true" tabindex="-1"></a><span class="st">&quot;foo&quot;</span></span></code></pre></div>
<aside class="notes">
<p>Strings are double quoted</p>
</aside>
</section>
<section id="nix-the-language-2" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb12"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb12-1"><a href="#cb12-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a multi-line string</span></span>
<span id="cb12-2"><a href="#cb12-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb12-3"><a href="#cb12-3" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;I&#39;m a mult-line</span></span>
<span id="cb12-4"><a href="#cb12-4" aria-hidden="true" tabindex="-1"></a><span class="st">string</span></span>
<span id="cb12-5"><a href="#cb12-5" aria-hidden="true" tabindex="-1"></a><span class="st">&#39;&#39;</span></span></code></pre></div>
<aside class="notes">
<p>Multi-line are quoted with two single quotes</p>
</aside>
</section>
<section id="nix-the-language-3" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb13"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb13-1"><a href="#cb13-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a number</span></span>
<span id="cb13-2"><a href="#cb13-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb13-3"><a href="#cb13-3" aria-hidden="true" tabindex="-1"></a><span class="dv">5</span></span></code></pre></div>
<aside class="notes">
<p>numbers look like numbers</p>
</aside>
</section>
<section id="nix-the-language-4" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb14"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb14-1"><a href="#cb14-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is a list of numbers and strings</span></span>
<span id="cb14-2"><a href="#cb14-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb14-3"><a href="#cb14-3" aria-hidden="true" tabindex="-1"></a><span class="op">[</span> <span class="dv">1</span> <span class="dv">2</span> <span class="st">&quot;foo&quot;</span> <span class="op">]</span></span></code></pre></div>
<aside class="notes">
<p>Lists use brackets and do not seperate with commas. Note that we can
have different types of items in our lists.</p>
</aside>
</section>
<section id="nix-the-language-5" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb15"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb15-1"><a href="#cb15-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is an empty &quot;attribute set&quot;, which is also like a dictionary or hash in other languages.</span></span>
<span id="cb15-2"><a href="#cb15-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb15-3"><a href="#cb15-3" aria-hidden="true" tabindex="-1"></a><span class="op">{}</span></span></code></pre></div>
<aside class="notes">
<p>Attribute-sets use curly braces and work like key-value storage
objects. This is like a dictionary, hash, or object (in javascript)</p>
</aside>
</section>
<section id="nix-the-language-6" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb16"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb16-1"><a href="#cb16-1" aria-hidden="true" tabindex="-1"></a><span class="co"># attribute sets can assign attributes</span></span>
<span id="cb16-2"><a href="#cb16-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb16-3"><a href="#cb16-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb16-4"><a href="#cb16-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">foo</span> <span class="op">=</span> <span class="st">&quot;bar&quot;</span><span class="op">;</span></span>
<span id="cb16-5"><a href="#cb16-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">baz</span> <span class="op">=</span> <span class="st">&quot;buzz&quot;</span><span class="op">;</span></span>
<span id="cb16-6"><a href="#cb16-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Example of assigning attribute sets. Note that the keys are not
quoted, and that semi-colons end each assignment.</p>
</aside>
</section>
<section id="nix-the-language-7" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb17"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb17-1"><a href="#cb17-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can make nested attribute sets</span></span>
<span id="cb17-2"><a href="#cb17-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb17-3"><a href="#cb17-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb17-4"><a href="#cb17-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">foo</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb17-5"><a href="#cb17-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">bar</span> <span class="op">=</span> <span class="st">&quot;baz&quot;</span><span class="op">;</span></span>
<span id="cb17-6"><a href="#cb17-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb17-7"><a href="#cb17-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Attribute sets can also hold attribute-sets</p>
</aside>
</section>
<section id="nix-the-language-8" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb18"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb18-1"><a href="#cb18-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Or assign them with a &quot;.&quot; for shorthand</span></span>
<span id="cb18-2"><a href="#cb18-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb18-3"><a href="#cb18-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">foo</span>.<span class="va">bar</span> <span class="op">=</span> <span class="st">&quot;baz&quot;</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>This is so common that there’s a shorthand for assigning nested
attributes.</p>
</aside>
</section>
<section id="nix-the-language-9" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb19"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb19-1"><a href="#cb19-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is our inputs example</span></span>
<span id="cb19-2"><a href="#cb19-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb19-3"><a href="#cb19-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb19-4"><a href="#cb19-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">inputs</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb19-5"><a href="#cb19-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">utils</span>.<span class="va">url</span> <span class="op">=</span> <span class="st">&quot;github:numtide/flake-utils&quot;</span><span class="op">;</span></span>
<span id="cb19-6"><a href="#cb19-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb19-7"><a href="#cb19-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Back to our inputs example. We can now understand this a bit more. Do
you see how you could re-write this to be shorter?</p>
</aside>
</section>
<section id="nix-the-language-10" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb20"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb20-1"><a href="#cb20-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is our inputs example, but shorter</span></span>
<span id="cb20-2"><a href="#cb20-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb20-3"><a href="#cb20-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb20-4"><a href="#cb20-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">inputs</span>.<span class="va">utils</span>.<span class="va">url</span> <span class="op">=</span> <span class="st">&quot;github:numtide/flake-utils&quot;</span><span class="op">;</span></span>
<span id="cb20-5"><a href="#cb20-5" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>We won’t actually change this, but here’s the shorter example.</p>
</aside>
</section>
<section id="nix-the-language-11" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb21"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb21-1"><a href="#cb21-1" aria-hidden="true" tabindex="-1"></a><span class="co"># a `:` denotes a function with arguments on left and function body on the right</span></span>
<span id="cb21-2"><a href="#cb21-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb21-3"><a href="#cb21-3" aria-hidden="true" tabindex="-1"></a><span class="va">x</span><span class="op">:</span> x <span class="op">+</span> <span class="dv">1</span></span></code></pre></div>
<aside class="notes">
<p>functions use a colon to with a single parameter on the left and
function body on the right</p>
</aside>
</section>
<section id="nix-the-language-12" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb22"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb22-1"><a href="#cb22-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You can call a function by applying an argument, but you may need to wrap in parenthesis</span></span>
<span id="cb22-2"><a href="#cb22-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb22-3"><a href="#cb22-3" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="va">x</span><span class="op">:</span> x <span class="op">+</span> <span class="dv">1</span><span class="op">)</span> <span class="dv">2</span></span></code></pre></div>
<aside class="notes">
<p>You can call a function applying an argument, but you may need to
wrap in parenthesis or nix will thing it’s a part of the function
body</p>
</aside>
</section>
<section id="nix-the-language-13" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb23"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb23-1"><a href="#cb23-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Most of the time you will see attributes as the function arguments</span></span>
<span id="cb23-2"><a href="#cb23-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb23-3"><a href="#cb23-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span> <span class="op">}</span>: a <span class="op">+</span> b</span></code></pre></div>
<aside class="notes">
<p>Most of the time you’ll see attribute sets as function arguments
because it makes it easier to add new values to a call.</p>
</aside>
</section>
<section id="nix-the-language-14" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb24"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb24-1"><a href="#cb24-1" aria-hidden="true" tabindex="-1"></a><span class="co"># When calling this you pass an attribute set</span></span>
<span id="cb24-2"><a href="#cb24-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb24-3"><a href="#cb24-3" aria-hidden="true" tabindex="-1"></a><span class="op">({</span> <span class="va">a</span><span class="op">,</span> <span class="va">b</span> <span class="op">}</span>: a <span class="op">+</span> b<span class="op">)</span> <span class="op">{</span></span>
<span id="cb24-4"><a href="#cb24-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">a</span> <span class="op">=</span> <span class="dv">2</span><span class="op">;</span></span>
<span id="cb24-5"><a href="#cb24-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">b</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb24-6"><a href="#cb24-6" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Calling a function with an attribute set works the same as it did
with the single value</p>
</aside>
</section>
<section id="nix-the-language-15" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb25"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb25-1"><a href="#cb25-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Functions can also be `curried`</span></span>
<span id="cb25-2"><a href="#cb25-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb25-3"><a href="#cb25-3" aria-hidden="true" tabindex="-1"></a><span class="va">a</span><span class="op">:</span> <span class="va">b</span><span class="op">:</span> a <span class="op">+</span> b</span></code></pre></div>
<aside class="notes">
<p>Functions can also be curried! This is a function that returns a
function that adds two numbers.</p>
</aside>
</section>
<section id="nix-the-language-16" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb26"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb26-1"><a href="#cb26-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, using parenthesis to apply</span></span>
<span id="cb26-2"><a href="#cb26-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb26-3"><a href="#cb26-3" aria-hidden="true" tabindex="-1"></a><span class="op">(</span><span class="va">a</span><span class="op">:</span> <span class="va">b</span><span class="op">:</span> a <span class="op">+</span> b<span class="op">)</span> <span class="dv">2</span> <span class="dv">3</span></span></code></pre></div>
<aside class="notes">
<p>We can use parenthesis to apply here. Note that if you left off the 3
here, you would have function that adds 2 to a number.</p>
</aside>
</section>
<section id="nix-the-language-17" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb27"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb27-1"><a href="#cb27-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Again, using parenthesis to apply</span></span>
<span id="cb27-2"><a href="#cb27-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb27-3"><a href="#cb27-3" aria-hidden="true" tabindex="-1"></a><span class="op">((</span><span class="va">a</span><span class="op">:</span> <span class="va">b</span><span class="op">:</span> a <span class="op">+</span> b<span class="op">)</span> <span class="dv">2</span><span class="op">)</span> <span class="dv">3</span></span></code></pre></div>
<aside class="notes">
<p>You can think of the application like this, but the extra parenthesis
aren’t needed single every function takes one argument.</p>
</aside>
</section>
<section id="nix-the-language-18" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb28"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb28-1"><a href="#cb28-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Now we can understand the output line a bit better (omitting the `system` body for now)...</span></span>
<span id="cb28-2"><a href="#cb28-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb28-3"><a href="#cb28-3" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb28-4"><a href="#cb28-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">outputs</span> <span class="op">=</span></span>
<span id="cb28-5"><a href="#cb28-5" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb28-6"><a href="#cb28-6" aria-hidden="true" tabindex="-1"></a>      <span class="va">self</span><span class="op">,</span></span>
<span id="cb28-7"><a href="#cb28-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">nixpkgs</span><span class="op">,</span></span>
<span id="cb28-8"><a href="#cb28-8" aria-hidden="true" tabindex="-1"></a>      <span class="va">utils</span><span class="op">,</span></span>
<span id="cb28-9"><a href="#cb28-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span>:</span>
<span id="cb28-10"><a href="#cb28-10" aria-hidden="true" tabindex="-1"></a>    utils<span class="op">.</span>lib<span class="op">.</span>eachDefaultSystem <span class="op">(</span><span class="va">system</span><span class="op">:</span> <span class="op">{</span> <span class="op">});</span></span>
<span id="cb28-11"><a href="#cb28-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Looking back at our outputs line, we can see that outputs is a key
for an attribute set that returns a function with an attribute set of
three values (self, nixpkgs, utils) and that function calls into
attribute set of utils lib eachDefaultSystem which passes a function
that takes system and returns an attribute set! For making this slide
shorter, the attribute set here is empty.</p>
</aside>
</section>
<section id="nix-the-language-19" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb29"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb29-1"><a href="#cb29-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `let` blocks allow you to assign values you can use inside an `in`attribute set </span></span>
<span id="cb29-2"><a href="#cb29-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb29-3"><a href="#cb29-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb29-4"><a href="#cb29-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">a</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb29-5"><a href="#cb29-5" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb29-6"><a href="#cb29-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb29-7"><a href="#cb29-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">x</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb29-8"><a href="#cb29-8" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Back to learning new things… let allows you to assign values you can
us in an in attribute set.</p>
</aside>
</section>
<section id="nix-the-language-20" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb30"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb30-1"><a href="#cb30-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sometimes you might want to refer to interpolated values for attribute keys</span></span>
<span id="cb30-2"><a href="#cb30-2" aria-hidden="true" tabindex="-1"></a><span class="co"># We can use `${}` for this</span></span>
<span id="cb30-3"><a href="#cb30-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb30-4"><a href="#cb30-4" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb30-5"><a href="#cb30-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">a</span> <span class="op">=</span> <span class="st">&quot;x&quot;</span><span class="op">;</span></span>
<span id="cb30-6"><a href="#cb30-6" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb30-7"><a href="#cb30-7" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb30-8"><a href="#cb30-8" aria-hidden="true" tabindex="-1"></a>  <span class="sc">${</span>a<span class="sc">}</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb30-9"><a href="#cb30-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Sometimes you may want to assign the value of what a is (i.e. x) as a
key. You can use interpolation of dollar curly braces for this.</p>
</aside>
</section>
<section id="nix-the-language-21" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb31"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb31-1"><a href="#cb31-1" aria-hidden="true" tabindex="-1"></a><span class="co"># This is how `${system}` being used in our flake. Here&#39;s smaller example that applies both</span></span>
<span id="cb31-2"><a href="#cb31-2" aria-hidden="true" tabindex="-1"></a><span class="co"># functions.</span></span>
<span id="cb31-3"><a href="#cb31-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb31-4"><a href="#cb31-4" aria-hidden="true" tabindex="-1"></a><span class="op">(</span></span>
<span id="cb31-5"><a href="#cb31-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">system</span><span class="op">:</span></span>
<span id="cb31-6"><a href="#cb31-6" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span> <span class="va">nixpkgs</span> <span class="op">}</span>:</span>
<span id="cb31-7"><a href="#cb31-7" aria-hidden="true" tabindex="-1"></a>  <span class="kw">let</span></span>
<span id="cb31-8"><a href="#cb31-8" aria-hidden="true" tabindex="-1"></a>    <span class="va">pkgs</span> <span class="op">=</span> nixpkgs<span class="op">.</span>legacyPackages<span class="op">.</span><span class="sc">${</span>system<span class="sc">}</span><span class="op">;</span></span>
<span id="cb31-9"><a href="#cb31-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">in</span></span>
<span id="cb31-10"><a href="#cb31-10" aria-hidden="true" tabindex="-1"></a>  pkgs</span>
<span id="cb31-11"><a href="#cb31-11" aria-hidden="true" tabindex="-1"></a><span class="op">)</span></span>
<span id="cb31-12"><a href="#cb31-12" aria-hidden="true" tabindex="-1"></a>  <span class="st">&quot;linux&quot;</span></span>
<span id="cb31-13"><a href="#cb31-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">{</span> <span class="va">nixpkgs</span>.<span class="va">legacyPackages</span>.<span class="va">linux</span> <span class="op">=</span> <span class="st">&quot;awesome&quot;</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Looking back at our system, that’s how it’s being used - the key is
interpolated</p>
</aside>
</section>
<section id="nix-the-language-22" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb32"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb32-1"><a href="#cb32-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning a value to it&#39;s name is so common that there&#39;s a shorthand with `inherit`</span></span>
<span id="cb32-2"><a href="#cb32-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb32-3"><a href="#cb32-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb32-4"><a href="#cb32-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">a</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb32-5"><a href="#cb32-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">b</span> <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb32-6"><a href="#cb32-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">c</span> <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb32-7"><a href="#cb32-7" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb32-8"><a href="#cb32-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb32-9"><a href="#cb32-9" aria-hidden="true" tabindex="-1"></a>  <span class="va">a</span> <span class="op">=</span> a<span class="op">;</span></span>
<span id="cb32-10"><a href="#cb32-10" aria-hidden="true" tabindex="-1"></a>  <span class="va">b</span> <span class="op">=</span> b<span class="op">;</span></span>
<span id="cb32-11"><a href="#cb32-11" aria-hidden="true" tabindex="-1"></a>  <span class="va">c</span> <span class="op">=</span> c<span class="op">;</span></span>
<span id="cb32-12"><a href="#cb32-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>You can assign multiple values. But there’s a shortcut because this
is so common.</p>
</aside>
</section>
<section id="nix-the-language-23" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb33"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb33-1"><a href="#cb33-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Assigning a value to it&#39;s name is so common that there&#39;s a shorthand with `inherit`</span></span>
<span id="cb33-2"><a href="#cb33-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb33-3"><a href="#cb33-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb33-4"><a href="#cb33-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">a</span> <span class="op">=</span> <span class="dv">10</span><span class="op">;</span></span>
<span id="cb33-5"><a href="#cb33-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">b</span> <span class="op">=</span> <span class="dv">12</span><span class="op">;</span></span>
<span id="cb33-6"><a href="#cb33-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">c</span> <span class="op">=</span> <span class="dv">5</span><span class="op">;</span></span>
<span id="cb33-7"><a href="#cb33-7" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb33-8"><a href="#cb33-8" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb33-9"><a href="#cb33-9" aria-hidden="true" tabindex="-1"></a>  <span class="kw">inherit</span> <span class="va">a</span> <span class="va">b</span> <span class="va">c</span><span class="op">;</span></span>
<span id="cb33-10"><a href="#cb33-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>It’s inherit This returns an attribute set with a b and c as keys and
the respective values as values.</p>
</aside>
</section>
<section id="nix-the-language-24" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb34"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb34-1"><a href="#cb34-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We have one last thing to learn before we understand all of our flake!</span></span>
<span id="cb34-2"><a href="#cb34-2" aria-hidden="true" tabindex="-1"></a><span class="co"># You can do it!</span></span></code></pre></div>
</section>
<section id="nix-the-language-25" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb35"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb35-1"><a href="#cb35-1" aria-hidden="true" tabindex="-1"></a><span class="co"># Sometimes repeating keys can get a bit cumbersome</span></span>
<span id="cb35-2"><a href="#cb35-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb35-3"><a href="#cb35-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb35-4"><a href="#cb35-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">x</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb35-5"><a href="#cb35-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">a</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb35-6"><a href="#cb35-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">b</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb35-7"><a href="#cb35-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">c</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb35-8"><a href="#cb35-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb35-9"><a href="#cb35-9" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb35-10"><a href="#cb35-10" aria-hidden="true" tabindex="-1"></a><span class="op">[</span></span>
<span id="cb35-11"><a href="#cb35-11" aria-hidden="true" tabindex="-1"></a>  x<span class="op">.</span>a</span>
<span id="cb35-12"><a href="#cb35-12" aria-hidden="true" tabindex="-1"></a>  x<span class="op">.</span>b</span>
<span id="cb35-13"><a href="#cb35-13" aria-hidden="true" tabindex="-1"></a>  x<span class="op">.</span>c</span>
<span id="cb35-14"><a href="#cb35-14" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span></code></pre></div>
<aside class="notes">
<p>Sometimes repeating keys can get cumbersome</p>
</aside>
</section>
<section id="nix-the-language-26" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb36"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb36-1"><a href="#cb36-1" aria-hidden="true" tabindex="-1"></a><span class="co"># We can use `with` to automatically scope all of the attributes in x</span></span>
<span id="cb36-2"><a href="#cb36-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb36-3"><a href="#cb36-3" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb36-4"><a href="#cb36-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">x</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb36-5"><a href="#cb36-5" aria-hidden="true" tabindex="-1"></a>    <span class="va">a</span> <span class="op">=</span> <span class="dv">1</span><span class="op">;</span></span>
<span id="cb36-6"><a href="#cb36-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">b</span> <span class="op">=</span> <span class="dv">3</span><span class="op">;</span></span>
<span id="cb36-7"><a href="#cb36-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">c</span> <span class="op">=</span> <span class="dv">4</span><span class="op">;</span></span>
<span id="cb36-8"><a href="#cb36-8" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb36-9"><a href="#cb36-9" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb36-10"><a href="#cb36-10" aria-hidden="true" tabindex="-1"></a><span class="kw">with</span> x<span class="op">;</span></span>
<span id="cb36-11"><a href="#cb36-11" aria-hidden="true" tabindex="-1"></a><span class="op">[</span></span>
<span id="cb36-12"><a href="#cb36-12" aria-hidden="true" tabindex="-1"></a>  a</span>
<span id="cb36-13"><a href="#cb36-13" aria-hidden="true" tabindex="-1"></a>  b</span>
<span id="cb36-14"><a href="#cb36-14" aria-hidden="true" tabindex="-1"></a>  c</span>
<span id="cb36-15"><a href="#cb36-15" aria-hidden="true" tabindex="-1"></a><span class="op">]</span></span></code></pre></div>
<aside class="notes">
<p>So there’s a with keyword that lets us automatically scope keys. This
is the same as x.a, x.b, x.c</p>
</aside>
</section>
<section id="nix-the-language-27" class="slide level1">
<h1>Nix the language</h1>
<div class="sourceCode" id="cb37"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb37-1"><a href="#cb37-1" aria-hidden="true" tabindex="-1"></a><span class="co"># You did it! Great job!</span></span></code></pre></div>
<aside class="notes">
<p>We made it through everything we need to understand out flake.</p>
</aside>
</section>
<section id="updating-our-flake" class="slide level1">
<h1>Updating our flake</h1>
<p><code>flake.nix</code>:</p>
<div class="sourceCode" id="cb38"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb38-1"><a href="#cb38-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb38-2"><a href="#cb38-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">inputs</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb38-3"><a href="#cb38-3" aria-hidden="true" tabindex="-1"></a>    <span class="va">utils</span>.<span class="va">url</span> <span class="op">=</span> <span class="st">&quot;github:numtide/flake-utils&quot;</span><span class="op">;</span></span>
<span id="cb38-4"><a href="#cb38-4" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb38-5"><a href="#cb38-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">outputs</span> <span class="op">=</span> <span class="op">{</span> <span class="va">self</span><span class="op">,</span> <span class="va">nixpkgs</span><span class="op">,</span> <span class="va">utils</span> <span class="op">}</span>: utils<span class="op">.</span>lib<span class="op">.</span>eachDefaultSystem <span class="op">(</span><span class="va">system</span><span class="op">:</span></span>
<span id="cb38-6"><a href="#cb38-6" aria-hidden="true" tabindex="-1"></a>    <span class="kw">let</span></span>
<span id="cb38-7"><a href="#cb38-7" aria-hidden="true" tabindex="-1"></a>      <span class="va">pkgs</span> <span class="op">=</span> nixpkgs<span class="op">.</span>legacyPackages<span class="op">.</span><span class="sc">${</span>system<span class="sc">}</span><span class="op">;</span></span>
<span id="cb38-8"><a href="#cb38-8" aria-hidden="true" tabindex="-1"></a>    <span class="kw">in</span></span>
<span id="cb38-9"><a href="#cb38-9" aria-hidden="true" tabindex="-1"></a>    <span class="op">{</span></span>
<span id="cb38-10"><a href="#cb38-10" aria-hidden="true" tabindex="-1"></a>      <span class="va">devShell</span> <span class="op">=</span> pkgs<span class="op">.</span>mkShell <span class="op">{</span></span>
<span id="cb38-11"><a href="#cb38-11" aria-hidden="true" tabindex="-1"></a>        <span class="va">buildInputs</span> <span class="op">=</span> <span class="kw">with</span> pkgs<span class="op">;</span> <span class="op">[</span></span>
<span id="cb38-12"><a href="#cb38-12" aria-hidden="true" tabindex="-1"></a>        <span class="op">];</span></span>
<span id="cb38-13"><a href="#cb38-13" aria-hidden="true" tabindex="-1"></a>      <span class="op">};</span></span>
<span id="cb38-14"><a href="#cb38-14" aria-hidden="true" tabindex="-1"></a>    <span class="op">}</span></span>
<span id="cb38-15"><a href="#cb38-15" aria-hidden="true" tabindex="-1"></a>  <span class="op">);</span></span>
<span id="cb38-16"><a href="#cb38-16" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Going back to our flake we can understand a bit better. A flake
returns an attribute set with a few defined attributes. Inputs which
define what a flake consumes and Outputs for what it produces. Our
inputs provide utils that get pulled from a github repo. Our outputs use
that utils flake to call eachDefaultSystem. This function call makes it
easier to define for all of our platforms (like arm64 macos, intel
linux, etc). Within our ouputs we pick the right packages for our system
architecture, then use that to build our dev shell. You’ll notice that
buildInputs is empty right now - this is where we’ll put packages that
we need.</p>
</aside>
</section>
<section id="moving-nixpkgs-to-stable" class="slide level1">
<h1>Moving nixpkgs to stable</h1>
<p>We add an input for nixpkgs to <code>25.05</code> (overriding
default)</p>
<div class="sourceCode" id="cb39"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb39-1"><a href="#cb39-1" aria-hidden="true" tabindex="-1"></a>inputs = <span class="op">{</span></span>
<span id="cb39-2"><a href="#cb39-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">nixpkgs</span>.<span class="va">url</span> <span class="op">=</span> <span class="st">&quot;github:nixos/nixpkgs/nixos-25.05&quot;</span><span class="op">;</span></span>
<span id="cb39-3"><a href="#cb39-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">utils</span>.<span class="va">url</span> <span class="op">=</span> <span class="st">&quot;github:numtide/flake-utils&quot;</span><span class="op">;</span></span>
<span id="cb39-4"><a href="#cb39-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>
<aside class="notes">
<p>But first, let’s add in a new input, nixpkgs While it was defaulting
to “unstable”, let’s actually pin to the current “stable” version of
nixpkgs Stable vs. Unstable here really means minor patches vs rolling
releases of features. Again, our input url comes from github.</p>
</aside>
</section>
<section id="adding-packages-to-our-devshell" class="slide level1">
<h1>Adding packages to our devShell</h1>
<p>These are for our rust app, but you can find more at <a
href="https://search.nixos.org">search.nixos.org</a></p>
<div class="sourceCode" id="cb40"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb40-1"><a href="#cb40-1" aria-hidden="true" tabindex="-1"></a>devShell = pkgs<span class="op">.</span>mkShell <span class="op">{</span></span>
<span id="cb40-2"><a href="#cb40-2" aria-hidden="true" tabindex="-1"></a>        <span class="va">buildInputs</span> <span class="op">=</span> <span class="kw">with</span> pkgs<span class="op">;</span> <span class="op">[</span></span>
<span id="cb40-3"><a href="#cb40-3" aria-hidden="true" tabindex="-1"></a>          cargo</span>
<span id="cb40-4"><a href="#cb40-4" aria-hidden="true" tabindex="-1"></a>          rustc</span>
<span id="cb40-5"><a href="#cb40-5" aria-hidden="true" tabindex="-1"></a>          rust-analyzer</span>
<span id="cb40-6"><a href="#cb40-6" aria-hidden="true" tabindex="-1"></a>          rustfmt</span>
<span id="cb40-7"><a href="#cb40-7" aria-hidden="true" tabindex="-1"></a>        <span class="op">];</span></span>
<span id="cb40-8"><a href="#cb40-8" aria-hidden="true" tabindex="-1"></a>      <span class="op">}</span>;</span>
<span id="cb40-9"><a href="#cb40-9" aria-hidden="true" tabindex="-1"></a>    }</span></code></pre></div>
<aside class="notes">
<p>Let’s add our packages to make a rust app. Here we add cargo, rustc,
rust-analyzer, &amp; rustfmt. Note that these all come from pkgs, but
we’re using the with to make this easier to read.</p>
</aside>
</section>
<section id="enter-the-devshell" class="slide level1">
<h1>Enter the devShell</h1>
<p>We can use <code>nix develop</code> to get to the shell.
<code>.#</code> is a reference to the current flake.</p>
<div class="sourceCode" id="cb41"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb41-1"><a href="#cb41-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix develop .#</span>
<span id="cb41-2"><a href="#cb41-2" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">nix:nix-shell-env</span><span class="kw">)</span> <span class="ex">bash-5.2$</span> rustc <span class="at">--version</span></span>
<span id="cb41-3"><a href="#cb41-3" aria-hidden="true" tabindex="-1"></a><span class="ex">rustc</span> 1.86.0 <span class="er">(</span><span class="ex">05f9846f8</span> 2025-03-31<span class="kw">)</span> <span class="kw">(</span><span class="ex">built</span> from a source tarball<span class="kw">)</span></span>
<span id="cb41-4"><a href="#cb41-4" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">nix:nix-shell-env</span><span class="kw">)</span> <span class="ex">bash-5.2$</span> cargo <span class="at">--version</span></span>
<span id="cb41-5"><a href="#cb41-5" aria-hidden="true" tabindex="-1"></a><span class="ex">cargo</span> 1.86.0 <span class="er">(</span><span class="ex">adf9b6ad1</span> 2025-02-28<span class="kw">)</span></span>
<span id="cb41-6"><a href="#cb41-6" aria-hidden="true" tabindex="-1"></a><span class="kw">(</span><span class="ex">nix:nix-shell-env</span><span class="kw">)</span> <span class="ex">bash-5.2$</span> exit</span>
<span id="cb41-7"><a href="#cb41-7" aria-hidden="true" tabindex="-1"></a><span class="bu">exit</span></span></code></pre></div>
<aside class="notes">
<p>Now that our flake is complete, we can use nix develop to enter a
shell with our buildInputs in our path. Note the use of .# here - .
means current source which is either the current working directory or
git root if in a git repository. The hash afterwards is to let us
specify a name - in this case we only have one devShell so it’s assumed
to be the default. Same for the reference .# is the same as
.#default</p>
</aside>
</section>
<section id="direnv-makes-this-better" class="slide level1">
<h1>direnv makes this better</h1>
<p>If you don’t already have direnv installed, you can install to your
profile via nix.</p>
<div class="sourceCode" id="cb42"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb42-1"><a href="#cb42-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix profile install nixpkgs#direnv</span>
<span id="cb42-2"><a href="#cb42-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">&#39;eval &quot;$(direnv hook zsh)&quot;&#39;</span> <span class="op">&gt;&gt;</span> ~/.bashrc</span>
<span id="cb42-3"><a href="#cb42-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> source ~/.bashrc</span></code></pre></div>
<aside class="notes">
<p>Let’s make this easier with direnv. If you don’t already have direnv
installed, you can use nix profile install to install it to your profile
for your user.</p>
</aside>
</section>
<section id="direnv-makes-this-better-1" class="slide level1">
<h1>direnv makes this better</h1>
<p>Now the flake is evaluated when we enter the directory</p>
<div class="sourceCode" id="cb43"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb43-1"><a href="#cb43-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> direnv allow</span>
<span id="cb43-2"><a href="#cb43-2" aria-hidden="true" tabindex="-1"></a><span class="ex">direnv:</span> loading ~/workspace/nix-first-steps/.envrc</span>
<span id="cb43-3"><a href="#cb43-3" aria-hidden="true" tabindex="-1"></a><span class="ex">direnv:</span> using flake</span>
<span id="cb43-4"><a href="#cb43-4" aria-hidden="true" tabindex="-1"></a><span class="ex">warning:</span> Git tree <span class="st">&#39;/Users/scott/workspace/nix-first-steps&#39;</span> has uncommitted changes</span>
<span id="cb43-5"><a href="#cb43-5" aria-hidden="true" tabindex="-1"></a><span class="ex">direnv:</span> export +AR +AS +CC +CONFIG_SHELL +CXX +DEVELOPER_DIR +HOST_PATH +IN_NIX_SHELL +LD +LD_DYLD_PATH +MACOSX_DEPLOYMENT_TARGET +NIX_APPLE_SDK_VERSION +NIX_BINTOOLS +NIX_BINTOOLS_WRAPPER_TARGET_HOST_arm64_apple_darwin +NIX_BUILD_CORES +NIX_BUILD_TOP +NIX_CC +NIX_CC_WRAPPER_TARGET_HOST_arm64_apple_darwin +NIX_CFLAGS_COMPILE +NIX_DONT_SET_RPATH +NIX_DONT_SET_RPATH_FOR_BUILD +NIX_ENFORCE_NO_NATIVE +NIX_HARDENING_ENABLE +NIX_IGNORE_LD_THROUGH_GCC +NIX_LDFLAGS +NIX_NO_SELF_RPATH +NIX_STORE +NM +OBJCOPY +OBJDUMP +PATH_LOCALE +RANLIB +SDKROOT +SIZE +SOURCE_DATE_EPOCH +STRINGS +STRIP +TEMP +TEMPDIR +TMP +ZERO_AR_DATE +__darwinAllowLocalNetworking +__impureHostDeps +__propagatedImpureHostDeps +__propagatedSandboxProfile +__sandboxProfile +__structuredAttrs +buildInputs +buildPhase +builder +cmakeFlags +configureFlags +depsBuildBuild +depsBuildBuildPropagated +depsBuildTarget +depsBuildTargetPropagated +depsHostHost +depsHostHostPropagated +depsTargetTarget +depsTargetTargetPropagated +doCheck +doInstallCheck +dontAddDisableDepTrack +mesonFlags +name +nativeBuildInputs +out +outputs +patches +phases +preferLocalBuild +propagatedBuildInputs +propagatedNativeBuildInputs +shell +shellHook +stdenv +strictDeps +system ~PATH ~TMPDIR ~XDG_DATA_DIRS</span></code></pre></div>
<aside class="notes">
<p>Now when we direnv allow and go back to our project, it will evaluate
our flake (because of our envrc) and export all important variables for
our devshell.</p>
</aside>
</section>
<section id="direnv-makes-this-better-2" class="slide level1">
<h1>direnv makes this better</h1>
<p>Now our packages are just in our path!</p>
<div class="sourceCode" id="cb44"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb44-1"><a href="#cb44-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rustc <span class="at">--version</span></span>
<span id="cb44-2"><a href="#cb44-2" aria-hidden="true" tabindex="-1"></a><span class="ex">rustc</span> 1.86.0 <span class="er">(</span><span class="ex">05f9846f8</span> 2025-03-31<span class="kw">)</span> <span class="kw">(</span><span class="ex">built</span> from a source tarball<span class="kw">)</span></span></code></pre></div>
<aside class="notes">
<p>Now we just have our packages in our path</p>
</aside>
</section>
<section id="building-our-app" class="slide level1">
<h1>Building our app</h1>
<p>Now that we have our environment, we can build our app.</p>
<div class="sourceCode" id="cb45"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb45-1"><a href="#cb45-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd ~/workspace/nix-first-steps</span>
<span id="cb45-2"><a href="#cb45-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cargo new hello-nix</span>
<span id="cb45-3"><a href="#cb45-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd hello-nix</span></code></pre></div>
<aside class="notes">
<p>We can build our rust app now with cargo</p>
</aside>
</section>
<section id="building-our-app-1" class="slide level1">
<h1>Building our app</h1>
<p>open up <code>hello-nix/src/main.rs</code> and change to the
following:</p>
<div class="sourceCode" id="cb46"><pre
class="sourceCode rust"><code class="sourceCode rust"><span id="cb46-1"><a href="#cb46-1" aria-hidden="true" tabindex="-1"></a><span class="kw">fn</span> main() <span class="op">{</span></span>
<span id="cb46-2"><a href="#cb46-2" aria-hidden="true" tabindex="-1"></a>    <span class="pp">println!</span>(<span class="st">&quot;Hello from nix!&quot;</span>)<span class="op">;</span></span>
<span id="cb46-3"><a href="#cb46-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>This is a pretty simple rust app for our demo purposes. If you don’t
know rust, that’s okay.</p>
</aside>
</section>
<section id="building-our-app-2" class="slide level1">
<h1>Building our app</h1>
<p>We can make sure this builds, tests, and runs.</p>
<div class="sourceCode" id="cb47"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb47-1"><a href="#cb47-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cargo build</span>
<span id="cb47-2"><a href="#cb47-2" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Compiling</span> hello-nix v0.1.0 <span class="er">(</span><span class="ex">/Users/scott/workspace/nix-first-steps/hello-nix</span><span class="kw">)</span></span>
<span id="cb47-3"><a href="#cb47-3" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.77s</span></span>
<span id="cb47-4"><a href="#cb47-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-5"><a href="#cb47-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cargo test</span>
<span id="cb47-6"><a href="#cb47-6" aria-hidden="true" tabindex="-1"></a>   <span class="ex">Compiling</span> hello-nix v0.1.0 <span class="er">(</span><span class="ex">/Users/scott/workspace/nix-first-steps/hello-nix</span><span class="kw">)</span></span>
<span id="cb47-7"><a href="#cb47-7" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Finished</span> <span class="kw">`</span><span class="bu">test</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.11s</span></span>
<span id="cb47-8"><a href="#cb47-8" aria-hidden="true" tabindex="-1"></a>       <span class="ex">Running</span> unittests src/main.rs <span class="er">(</span><span class="ex">target/debug/deps/hello_nix-c7e1c6d541507f78</span><span class="kw">)</span></span>
<span id="cb47-9"><a href="#cb47-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-10"><a href="#cb47-10" aria-hidden="true" tabindex="-1"></a><span class="ex">running</span> 0 tests</span>
<span id="cb47-11"><a href="#cb47-11" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-12"><a href="#cb47-12" aria-hidden="true" tabindex="-1"></a><span class="bu">test</span> result: ok. 0 passed<span class="kw">;</span> <span class="ex">0</span> failed<span class="kw">;</span> <span class="ex">0</span> ignored<span class="kw">;</span> <span class="ex">0</span> measured<span class="kw">;</span> <span class="ex">0</span> filtered out<span class="kw">;</span> <span class="ex">finished</span> in 0.00s</span>
<span id="cb47-13"><a href="#cb47-13" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb47-14"><a href="#cb47-14" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cargo run</span>
<span id="cb47-15"><a href="#cb47-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.00s</span></span>
<span id="cb47-16"><a href="#cb47-16" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Running</span> <span class="kw">`</span><span class="ex">target/debug/hello-nix</span><span class="kw">`</span></span>
<span id="cb47-17"><a href="#cb47-17" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> from nix!</span></code></pre></div>
<aside class="notes">
<p>our build and tests (which don’t exist yet), all work</p>
</aside>
</section>
<section id="building-with-nix" class="slide level1">
<h1>Building with nix</h1>
<p>Let’s make a new file, <code>default.nix</code> and put it in the
<code>hello-nix</code> directory.</p>
<div class="sourceCode" id="cb48"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb48-1"><a href="#cb48-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">pkgs</span> <span class="op">?</span> <span class="bu">import</span> &lt;nixpkgs&gt; <span class="op">{</span> <span class="op">}</span> <span class="op">}</span>:</span>
<span id="cb48-2"><a href="#cb48-2" aria-hidden="true" tabindex="-1"></a>pkgs<span class="op">.</span>rustPlatform<span class="op">.</span>buildRustPackage <span class="op">{</span></span>
<span id="cb48-3"><a href="#cb48-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">pname</span> <span class="op">=</span> <span class="st">&quot;hello-nix&quot;</span><span class="op">;</span></span>
<span id="cb48-4"><a href="#cb48-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">version</span> <span class="op">=</span> <span class="st">&quot;0.0.1&quot;</span><span class="op">;</span></span>
<span id="cb48-5"><a href="#cb48-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">cargoLock</span>.<span class="va">lockFile</span> <span class="op">=</span> <span class="ss">./Cargo.lock</span><span class="op">;</span></span>
<span id="cb48-6"><a href="#cb48-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">src</span> <span class="op">=</span> pkgs<span class="op">.</span>lib<span class="op">.</span>cleanSource <span class="ss">./.</span><span class="op">;</span></span>
<span id="cb48-7"><a href="#cb48-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Now let’s see if we can make our app as a nix package This will let
us have a reproducible build we could share with others. There’s some
new syntax here, we haven’t seen yet…</p>
</aside>
</section>
<section id="new-syntax-for-nix" class="slide level1">
<h1>New syntax for nix</h1>
<div class="sourceCode" id="cb49"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb49-1"><a href="#cb49-1" aria-hidden="true" tabindex="-1"></a><span class="co"># The `?` allows us to have optional values in attribute sets. This comes in handy for optional</span></span>
<span id="cb49-2"><a href="#cb49-2" aria-hidden="true" tabindex="-1"></a><span class="co"># arguments in functions.</span></span>
<span id="cb49-3"><a href="#cb49-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb49-4"><a href="#cb49-4" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">foo</span> <span class="op">?</span> <span class="st">&quot;foo&quot;</span> <span class="op">}</span>: foo</span></code></pre></div>
<aside class="notes">
<p>? allows us to have optional values in an attribute set by providing
a default. This is really handy for functions</p>
</aside>
</section>
<section id="new-syntax-for-nix-1" class="slide level1">
<h1>New syntax for nix</h1>
<div class="sourceCode" id="cb50"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb50-1"><a href="#cb50-1" aria-hidden="true" tabindex="-1"></a><span class="co"># you can either apply without that name set.</span></span>
<span id="cb50-2"><a href="#cb50-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb50-3"><a href="#cb50-3" aria-hidden="true" tabindex="-1"></a><span class="op">({</span> <span class="va">foo</span> <span class="op">?</span> <span class="st">&quot;foo&quot;</span> <span class="op">}</span>: foo<span class="op">)</span> <span class="op">{}</span></span></code></pre></div>
<aside class="notes">
<p>We can apply it without “foo”</p>
</aside>
</section>
<section id="new-syntax-for-nix-2" class="slide level1">
<h1>New syntax for nix</h1>
<div class="sourceCode" id="cb51"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb51-1"><a href="#cb51-1" aria-hidden="true" tabindex="-1"></a><span class="co"># or with it</span></span>
<span id="cb51-2"><a href="#cb51-2" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb51-3"><a href="#cb51-3" aria-hidden="true" tabindex="-1"></a><span class="op">({</span> <span class="va">foo</span> <span class="op">?</span> <span class="st">&quot;foo&quot;</span> <span class="op">}</span>: foo<span class="op">)</span> <span class="op">{</span> <span class="va">foo</span> <span class="op">=</span> <span class="st">&quot;bar&quot;</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Or with it</p>
</aside>
</section>
<section id="new-syntax-for-nix-3" class="slide level1">
<h1>New syntax for nix</h1>
<div class="sourceCode" id="cb52"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb52-1"><a href="#cb52-1" aria-hidden="true" tabindex="-1"></a><span class="co"># `import` is a special builtin function for loading code.</span></span>
<span id="cb52-2"><a href="#cb52-2" aria-hidden="true" tabindex="-1"></a><span class="co"># `./filename` is path variable relative by current directory.</span></span>
<span id="cb52-3"><a href="#cb52-3" aria-hidden="true" tabindex="-1"></a><span class="co"># We can use this to import our new `default.nix` file</span></span>
<span id="cb52-4"><a href="#cb52-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb52-5"><a href="#cb52-5" aria-hidden="true" tabindex="-1"></a><span class="bu">import</span> <span class="ss">./default.nix</span></span></code></pre></div>
<aside class="notes">
<p>import is a special builtin function that loads code (like other
languages) ./filename is a new type that we haven’t seen before - it’s a
“file” variable It’s relative to the current directory and we can use it
to pass to our import</p>
</aside>
</section>
<section id="new-syntax-for-nix-4" class="slide level1">
<h1>New syntax for nix</h1>
<div class="sourceCode" id="cb53"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb53-1"><a href="#cb53-1" aria-hidden="true" tabindex="-1"></a><span class="co"># &lt;nixpkgs&gt; is a special value that resolves lookup paths for $NIX_PATH</span></span>
<span id="cb53-2"><a href="#cb53-2" aria-hidden="true" tabindex="-1"></a><span class="co"># This can be used to dynamically load whichever location nix is set to</span></span>
<span id="cb53-3"><a href="#cb53-3" aria-hidden="true" tabindex="-1"></a><span class="co"># That means that the argument to our function takes an attribute set with</span></span>
<span id="cb53-4"><a href="#cb53-4" aria-hidden="true" tabindex="-1"></a><span class="co"># an options pkgs that defaults to the imported version of `nixpkgs` if passed in.</span></span>
<span id="cb53-5"><a href="#cb53-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb53-6"><a href="#cb53-6" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">pkgs</span> <span class="op">?</span> <span class="bu">import</span> &lt;nixpkgs&gt; <span class="op">{</span> <span class="op">}</span> <span class="op">}</span>: <span class="op">{}</span></span></code></pre></div>
<aside class="notes">
<p><nixpkgs> is a special value that resolves from the NIX_PATH
environment variable The ? allows us to pass in our own pkgs or default
to the current nixpkgs default</p>
</aside>
</section>
<section id="new-syntax-for-nix-5" class="slide level1">
<h1>New syntax for nix</h1>
<p>back to our <code>default.nix</code></p>
<div class="sourceCode" id="cb54"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb54-1"><a href="#cb54-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span> <span class="va">pkgs</span> <span class="op">?</span> <span class="bu">import</span> &lt;nixpkgs&gt; <span class="op">{</span> <span class="op">}</span> <span class="op">}</span>:</span>
<span id="cb54-2"><a href="#cb54-2" aria-hidden="true" tabindex="-1"></a>pkgs<span class="op">.</span>rustPlatform<span class="op">.</span>buildRustPackage <span class="op">{</span></span>
<span id="cb54-3"><a href="#cb54-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">pname</span> <span class="op">=</span> <span class="st">&quot;hello-nix&quot;</span><span class="op">;</span></span>
<span id="cb54-4"><a href="#cb54-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">version</span> <span class="op">=</span> <span class="st">&quot;0.0.1&quot;</span><span class="op">;</span></span>
<span id="cb54-5"><a href="#cb54-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">cargoLock</span>.<span class="va">lockFile</span> <span class="op">=</span> <span class="ss">./Cargo.lock</span><span class="op">;</span></span>
<span id="cb54-6"><a href="#cb54-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">src</span> <span class="op">=</span> pkgs<span class="op">.</span>lib<span class="op">.</span>cleanSource <span class="ss">./.</span><span class="op">;</span></span>
<span id="cb54-7"><a href="#cb54-7" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Back to our default.nix, we can read the rest of this We’re building
a function that takes in an optional pkgs, then using that to call the
buildRustPackage function which takes an attribute set including the
package name, version, cargo lockfile (loaded as a relative file), and
the source code in the current directory imported as ./.</p>
</aside>
</section>
<section id="building-our-package" class="slide level1">
<h1>Building our package</h1>
<p>We can use the <code>nix build</code> command to build</p>
<div class="sourceCode" id="cb55"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb55-1"><a href="#cb55-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix build <span class="at">-f</span> default.nix</span></code></pre></div>
<aside class="notes">
<p>Now we can build with nix build passing the file with a -f</p>
</aside>
</section>
<section id="building-our-package-1" class="slide level1">
<h1>Building our package</h1>
<p>And see the results…</p>
<div class="sourceCode" id="cb56"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb56-1"><a href="#cb56-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-la</span> result</span>
<span id="cb56-2"><a href="#cb56-2" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwxr-xr-x</span> 1 scott staff 59 Jun 29 17:26 result <span class="at">-</span><span class="op">&gt;</span> /nix/store/rj2wf0vgsgbsadlad6nxssnb4lhqvjw1-hello-nix-0.0.1</span>
<span id="cb56-3"><a href="#cb56-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./result/bin/hello-nix</span>
<span id="cb56-4"><a href="#cb56-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> from nix!</span>
<span id="cb56-5"><a href="#cb56-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rm result</span></code></pre></div>
<aside class="notes">
<p>When we build, you’ll notice that a result symlink is created that
points to our package that was built. Note the content addressable hash,
name, and version. If any of these change, it builds to a new path.
Inside that package is our rust binary We can rm the symlink when we are
done</p>
</aside>
</section>
<section id="adding-package-to-our-flake" class="slide level1">
<h1>Adding package to our flake</h1>
<p>back up to our <code>flake.nix</code>, we provide this as the
<code>default</code> package</p>
<div class="sourceCode" id="cb57"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb57-1"><a href="#cb57-1" aria-hidden="true" tabindex="-1"></a><span class="kw">{</span></span>
<span id="cb57-2"><a href="#cb57-2" aria-hidden="true" tabindex="-1"></a>  <span class="ex">devShell</span> = pkgs.mkShell {</span>
<span id="cb57-3"><a href="#cb57-3" aria-hidden="true" tabindex="-1"></a>    <span class="co"># ...</span></span>
<span id="cb57-4"><a href="#cb57-4" aria-hidden="true" tabindex="-1"></a>  <span class="kw">};</span></span>
<span id="cb57-5"><a href="#cb57-5" aria-hidden="true" tabindex="-1"></a>  <span class="ex">packages.default</span> = pkgs.callPackage ./hello-nix { inherit pkgs<span class="kw">;</span> <span class="er">}</span></span>
<span id="cb57-6"><a href="#cb57-6" aria-hidden="true" tabindex="-1"></a><span class="er">}</span></span></code></pre></div>
<aside class="notes">
<p>Now that we have our package, we can add to our flake. In addition to
our devshell, we’re assigning a default package and calling
hello-nix/default.nix Note a few things here - ./hello-nix is again a
path variable pointing to that directory. Call package will look for a
default.nix in that directory, but if we wanted a different name we
could be explicit. We also use inherit to pass along the version of pkgs
from our flake, which we remember is set to 25.05 nixpkgs.</p>
</aside>
</section>
<section id="adding-package-to-our-flake-1" class="slide level1">
<h1>Adding package to our flake</h1>
<p>and rebuild it! Note the syntax again of <code>.#</code></p>
<div class="sourceCode" id="cb58"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb58-1"><a href="#cb58-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix build .#</span></code></pre></div>
<aside class="notes">
<p>Now we can use nix build with our flake reference. Again we are using
.# to tell nix build to look at packages.default</p>
</aside>
</section>
<section id="error-with-build" class="slide level1">
<h1>Error with build</h1>
<div class="sourceCode" id="cb59"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb59-1"><a href="#cb59-1" aria-hidden="true" tabindex="-1"></a><span class="ex">warning:</span> Git tree <span class="st">&#39;/Users/scott/workspace/nix-first-steps&#39;</span> has uncommitted changes</span>
<span id="cb59-2"><a href="#cb59-2" aria-hidden="true" tabindex="-1"></a><span class="ex">error:</span></span>
<span id="cb59-3"><a href="#cb59-3" aria-hidden="true" tabindex="-1"></a> <span class="ex">…</span> while evaluating a branch condition</span>
<span id="cb59-4"><a href="#cb59-4" aria-hidden="true" tabindex="-1"></a>   <span class="ex">at</span> «github:nixos/nixpkgs/a676066377a2fe7457369dd37c31fd2263b662f4<span class="pp">?</span>narHash=sha256-zW/OFnotiz/ndPFdebpo3X0CrbVNf22n4DjN2vxlb58%3D»/nix/store/i56fkj8igf4wdvm6dglcj3lzi2j1r7pq-source/lib/customisation.nix:305:5:</span>
<span id="cb59-5"><a href="#cb59-5" aria-hidden="true" tabindex="-1"></a>    <span class="ex">304</span><span class="kw">|</span>     <span class="er">in</span></span>
<span id="cb59-6"><a href="#cb59-6" aria-hidden="true" tabindex="-1"></a>    <span class="ex">305</span><span class="kw">|</span>     <span class="cf">if</span> <span class="ex">missingArgs</span> == { } then</span>
<span id="cb59-7"><a href="#cb59-7" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span>     <span class="ex">^</span></span>
<span id="cb59-8"><a href="#cb59-8" aria-hidden="true" tabindex="-1"></a>    <span class="ex">306</span><span class="kw">|</span>       <span class="ex">makeOverridable</span> f allArgs</span>
<span id="cb59-9"><a href="#cb59-9" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-10"><a href="#cb59-10" aria-hidden="true" tabindex="-1"></a> <span class="ex">…</span> while calling the <span class="st">&#39;removeAttrs&#39;</span> builtin</span>
<span id="cb59-11"><a href="#cb59-11" aria-hidden="true" tabindex="-1"></a>   <span class="ex">at</span> «github:nixos/nixpkgs/a676066377a2fe7457369dd37c31fd2263b662f4<span class="pp">?</span>narHash=sha256-zW/OFnotiz/ndPFdebpo3X0CrbVNf22n4DjN2vxlb58%3D»/nix/store/i56fkj8igf4wdvm6dglcj3lzi2j1r7pq-source/lib/attrsets.nix:657:28:</span>
<span id="cb59-12"><a href="#cb59-12" aria-hidden="true" tabindex="-1"></a>    <span class="ex">656</span><span class="kw">|</span>   <span class="ex">*/</span></span>
<span id="cb59-13"><a href="#cb59-13" aria-hidden="true" tabindex="-1"></a>    <span class="ex">657</span><span class="kw">|</span>   <span class="ex">filterAttrs</span> = pred: set: removeAttrs set <span class="er">(</span><span class="ex">filter</span> <span class="er">(</span><span class="ex">name:</span> !pred name set.<span class="va">${name}</span><span class="kw">)</span> <span class="kw">(</span><span class="ex">attrNames</span> set<span class="kw">));</span></span>
<span id="cb59-14"><a href="#cb59-14" aria-hidden="true" tabindex="-1"></a>       <span class="kw">|</span>                            <span class="ex">^</span></span>
<span id="cb59-15"><a href="#cb59-15" aria-hidden="true" tabindex="-1"></a>    <span class="ex">658</span><span class="kw">|</span></span>
<span id="cb59-16"><a href="#cb59-16" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-17"><a href="#cb59-17" aria-hidden="true" tabindex="-1"></a> <span class="kw">(</span><span class="ex">stack</span> trace truncated<span class="kw">;</span> <span class="ex">use</span> <span class="st">&#39;--show-trace&#39;</span> to show the full, detailed trace<span class="kw">)</span></span>
<span id="cb59-18"><a href="#cb59-18" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-19"><a href="#cb59-19" aria-hidden="true" tabindex="-1"></a>  <span class="ex">error:</span> Path <span class="st">&#39;hello-nix&#39;</span> in the repository <span class="st">&quot;/Users/scott/workspace/nix-first-steps&quot;</span> is not tracked by Git.</span>
<span id="cb59-20"><a href="#cb59-20" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-21"><a href="#cb59-21" aria-hidden="true" tabindex="-1"></a> <span class="ex">To</span> make it visible to Nix, run:</span>
<span id="cb59-22"><a href="#cb59-22" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb59-23"><a href="#cb59-23" aria-hidden="true" tabindex="-1"></a> <span class="fu">git</span> <span class="at">-C</span> <span class="st">&quot;/Users/scott/workspace/nix-first-steps&quot;</span> add <span class="st">&quot;hello-nix&quot;</span></span></code></pre></div>
<aside class="notes">
<p>But we get an error! This is a common gotcha with using a flakes vs
our file directory. If you do have a git repo, you need to git add files
so that the flake can access them.</p>
</aside>
</section>
<section id="cleaning-up-git" class="slide level1">
<h1>Cleaning up git</h1>
<div class="sourceCode" id="cb60"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb60-1"><a href="#cb60-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">&quot;target&quot;</span> <span class="op">&gt;&gt;</span> .gitignore</span>
<span id="cb60-2"><a href="#cb60-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> echo <span class="st">&quot;.direnv&quot;</span> <span class="op">&gt;&gt;</span> .gitignore</span>
<span id="cb60-3"><a href="#cb60-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git add <span class="st">&quot;hello-nix&quot;</span></span></code></pre></div>
<aside class="notes">
<p>So we git add things, but we add a few git ignores first</p>
</aside>
</section>
<section id="build-success" class="slide level1">
<h1>Build success</h1>
<div class="sourceCode" id="cb61"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb61-1"><a href="#cb61-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix build .#</span>
<span id="cb61-2"><a href="#cb61-2" aria-hidden="true" tabindex="-1"></a><span class="ex">warning:</span> Git tree <span class="st">&#39;/Users/scott/workspace/nix-first-steps&#39;</span> has uncommitted changes</span>
<span id="cb61-3"><a href="#cb61-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ls <span class="at">-l</span> result</span>
<span id="cb61-4"><a href="#cb61-4" aria-hidden="true" tabindex="-1"></a><span class="ex">lrwxr-xr-x</span> 1 scott staff 59 Jun 29 17:45 result <span class="at">-</span><span class="op">&gt;</span> /nix/store/yqw9zry7dsgyr692y18pb330xhwlrwr5-hello-nix-0.0.1</span>
<span id="cb61-5"><a href="#cb61-5" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> ./result/bin/hello-nix</span>
<span id="cb61-6"><a href="#cb61-6" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> from nix!</span>
<span id="cb61-7"><a href="#cb61-7" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> rm result</span></code></pre></div>
<aside class="notes">
<p>Now it works! Just like before, it creates a symlink to our package.
You’ll notice the content addressable hash here is actually different
It’s because we’re now using the nixpkgs 25.05 pinned in our flake lock
vs unstable nixpkgs Because the input is different, it’s a new
package</p>
</aside>
</section>
<section id="portability-of-package" class="slide level1">
<h1>Portability of package</h1>
<p>If we push this to github we could run this automatically!</p>
<div class="sourceCode" id="cb62"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb62-1"><a href="#cb62-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix run github:sentientmonkey/nix-first-steps</span>
<span id="cb62-2"><a href="#cb62-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> from nix!</span>
<span id="cb62-3"><a href="#cb62-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix .#</span>
<span id="cb62-4"><a href="#cb62-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> from nix!</span></code></pre></div>
<aside class="notes">
<p>If we did push our repo here to github, we could use nix run to
invoke it directly otherwise, we can just use .# to run the default
package</p>
</aside>
</section>
<section id="lets-build-for-docker" class="slide level1">
<h1>Let’s Build for Docker</h1>
<p>Create a new file <code>hello-nix/build-docker.nix</code></p>
<div class="sourceCode" id="cb63"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb63-1"><a href="#cb63-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb63-2"><a href="#cb63-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">pkgs</span> <span class="op">?</span> <span class="bu">import</span> &lt;nixpkgs&gt; <span class="op">{</span> <span class="op">}</span></span>
<span id="cb63-3"><a href="#cb63-3" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>:</span>
<span id="cb63-4"><a href="#cb63-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb63-5"><a href="#cb63-5" aria-hidden="true" tabindex="-1"></a>pkgs<span class="op">.</span>dockerTools<span class="op">.</span>buildImage <span class="op">{</span></span>
<span id="cb63-6"><a href="#cb63-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">name</span> <span class="op">=</span> <span class="st">&quot;hello-nix&quot;</span><span class="op">;</span></span>
<span id="cb63-7"><a href="#cb63-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">tag</span> <span class="op">=</span> <span class="st">&quot;0.0.1&quot;</span><span class="op">;</span></span>
<span id="cb63-8"><a href="#cb63-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">config</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb63-9"><a href="#cb63-9" aria-hidden="true" tabindex="-1"></a>    <span class="va">Cmd</span> <span class="op">=</span> <span class="op">[</span> <span class="st">&quot;</span><span class="sc">${</span>pkgs<span class="op">.</span>hello<span class="sc">}</span><span class="st">/bin/hello&quot;</span> <span class="op">];</span></span>
<span id="cb63-10"><a href="#cb63-10" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb63-11"><a href="#cb63-11" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Now let’s try to build a docker image for our app. We make a new file
here for another package build. This time we’re using buildImage instead
of buildRustPackage. This takes a name, tag, and command that we can use
the “hello” package. Note the interpolation here for the package.</p>
</aside>
</section>
<section id="building-and-loading" class="slide level1">
<h1>Building and loading</h1>
<div class="sourceCode" id="cb64"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb64-1"><a href="#cb64-1" aria-hidden="true" tabindex="-1"></a>$ docker load &lt; $<span class="op">(</span>nix build <span class="op">-</span>f <span class="ss">hello-nix/build-docker.nix</span> <span class="op">--</span>no<span class="op">-</span>link <span class="op">--</span>print<span class="op">-</span>out<span class="op">-</span>paths<span class="op">)</span></span>
<span id="cb64-2"><a href="#cb64-2" aria-hidden="true" tabindex="-1"></a>Loaded <span class="va">image</span><span class="op">:</span> <span class="va">hello-nix</span><span class="op">:</span><span class="dv">0</span><span class="op">.</span>0.1</span>
<span id="cb64-3"><a href="#cb64-3" aria-hidden="true" tabindex="-1"></a>$ docker run <span class="va">hello-nix</span><span class="op">:</span><span class="dv">0</span><span class="op">.</span>0.1</span>
<span id="cb64-4"><a href="#cb64-4" aria-hidden="true" tabindex="-1"></a>Hello, World<span class="op">!</span></span></code></pre></div>
<aside class="notes">
<p>We can now build and load this into docker. Note that our build is
making an OCI image (which only will built on linux, sorry!) and we use
–no-link to avoid the symlink and –print-out-paths to give us the zipped
tarball to load directly into docker. Running it gives the default for
the “hello” package.</p>
</aside>
</section>
<section id="adding-dockerimage-to-our-flake" class="slide level1">
<h1>Adding dockerImage to our flake</h1>
<p>add to our top level <code>flake.nix</code></p>
<div class="sourceCode" id="cb65"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb65-1"><a href="#cb65-1" aria-hidden="true" tabindex="-1"></a>packages<span class="op">.</span>default = pkgs<span class="op">.</span>callPackage <span class="ss">./hello-nix</span> <span class="op">{</span> <span class="kw">inherit</span> <span class="va">pkgs</span><span class="op">;</span> <span class="op">}</span></span>
<span id="cb65-2"><a href="#cb65-2" aria-hidden="true" tabindex="-1"></a>packages<span class="op">.</span>dockerImage = pkgs<span class="op">.</span>callPackage <span class="ss">./hello-nix/build-docker.nix</span> <span class="op">{</span> <span class="kw">inherit</span> <span class="va">pkgs</span><span class="op">;</span> <span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Like before, we can call this package in our flake. This time we name
it dockerImage.</p>
</aside>
</section>
<section id="run-docker-build-with-flake" class="slide level1">
<h1>Run docker build with flake</h1>
<div class="sourceCode" id="cb66"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb66-1"><a href="#cb66-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> git add hello-nix/build-docker.nix</span>
<span id="cb66-2"><a href="#cb66-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker load <span class="op">&lt;</span> <span class="va">$(</span><span class="ex">nix</span> build .#dockerImage <span class="at">--no-link</span> <span class="at">--print-out-paths</span><span class="va">)</span></span>
<span id="cb66-3"><a href="#cb66-3" aria-hidden="true" tabindex="-1"></a><span class="ex">Loaded</span> image: hello-nix:0.0.1</span>
<span id="cb66-4"><a href="#cb66-4" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run hello-nix:0.0.1</span>
<span id="cb66-5"><a href="#cb66-5" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello,</span> World!</span></code></pre></div>
<aside class="notes">
<p>We remember to git add, and now we can build with .#dockerImage
instead of the file path But this isn’t our app yet, it’s just the
default hello package. Let’s fix that now.</p>
</aside>
</section>
<section id="small-refactor-in-our-flake" class="slide level1">
<h1>Small refactor in our flake</h1>
<div class="sourceCode" id="cb67"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb67-1"><a href="#cb67-1" aria-hidden="true" tabindex="-1"></a><span class="kw">let</span></span>
<span id="cb67-2"><a href="#cb67-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">pkgs</span> <span class="op">=</span> nixpkgs<span class="op">.</span>legacyPackages<span class="op">.</span><span class="sc">${</span>system<span class="sc">}</span><span class="op">;</span></span>
<span id="cb67-3"><a href="#cb67-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">helloNix</span> <span class="op">=</span> pkgs<span class="op">.</span>callPackage <span class="ss">./hello-nix</span> <span class="op">{</span> <span class="kw">inherit</span> <span class="va">pkgs</span><span class="op">;</span> <span class="op">};</span></span>
<span id="cb67-4"><a href="#cb67-4" aria-hidden="true" tabindex="-1"></a><span class="kw">in</span></span>
<span id="cb67-5"><a href="#cb67-5" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb67-6"><a href="#cb67-6" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ...</span></span>
<span id="cb67-7"><a href="#cb67-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">packages</span>.<span class="va">default</span> <span class="op">=</span> helloNix<span class="op">;</span></span>
<span id="cb67-8"><a href="#cb67-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">packages</span>.<span class="va">dockerImage</span> <span class="op">=</span> pkgs<span class="op">.</span>callPackage <span class="ss">./hello-nix/build-docker.nix</span> <span class="op">{</span> <span class="kw">inherit</span> <span class="va">pkgs</span><span class="op">;</span> <span class="op">};</span></span>
<span id="cb67-9"><a href="#cb67-9" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>First, let’s do a small refactor to make things easier. We can assign
our hello nix build to an attribute in our let block, and then use it to
assign to our default image.</p>
</aside>
</section>
<section id="small-refactor-to-our-flake" class="slide level1">
<h1>Small refactor to our flake</h1>
<div class="sourceCode" id="cb68"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb68-1"><a href="#cb68-1" aria-hidden="true" tabindex="-1"></a>packages<span class="op">.</span>dockerImage = pkgs<span class="op">.</span>callPackage <span class="ss">./hello-nix/build-docker.nix</span> <span class="op">{</span> <span class="kw">inherit</span> <span class="va">pkgs</span> <span class="va">helloNix</span><span class="op">;</span> <span class="op">}</span>;</span></code></pre></div>
<aside class="notes">
<p>Now we can pass that package along to our call to our
build-docker.nix</p>
</aside>
</section>
<section id="back-to-our-build-we-can-use-our-package"
class="slide level1">
<h1>Back to our build, we can use our package</h1>
<div class="sourceCode" id="cb69"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb69-1"><a href="#cb69-1" aria-hidden="true" tabindex="-1"></a><span class="op">{</span></span>
<span id="cb69-2"><a href="#cb69-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">helloNix</span><span class="op">,</span></span>
<span id="cb69-3"><a href="#cb69-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">pkgs</span> <span class="op">?</span> <span class="bu">import</span> &lt;nixpkgs&gt; <span class="op">{</span> <span class="op">},</span></span>
<span id="cb69-4"><a href="#cb69-4" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>:</span>
<span id="cb69-5"><a href="#cb69-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb69-6"><a href="#cb69-6" aria-hidden="true" tabindex="-1"></a>pkgs<span class="op">.</span>dockerTools<span class="op">.</span>buildImage <span class="op">{</span></span>
<span id="cb69-7"><a href="#cb69-7" aria-hidden="true" tabindex="-1"></a>  <span class="va">name</span> <span class="op">=</span> <span class="st">&quot;hello-nix&quot;</span><span class="op">;</span></span>
<span id="cb69-8"><a href="#cb69-8" aria-hidden="true" tabindex="-1"></a>  <span class="va">tag</span> <span class="op">=</span> helloNix<span class="op">.</span>version</span>
<span id="cb69-9"><a href="#cb69-9" aria-hidden="true" tabindex="-1"></a>  config = <span class="op">{</span></span>
<span id="cb69-10"><a href="#cb69-10" aria-hidden="true" tabindex="-1"></a>    <span class="va">Cmd</span> <span class="op">=</span> <span class="op">[</span> <span class="st">&quot;</span><span class="sc">${</span>helloNix<span class="sc">}</span><span class="st">/bin/hello-nix&quot;</span> <span class="op">];</span></span>
<span id="cb69-11"><a href="#cb69-11" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb69-12"><a href="#cb69-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>in our build, we add helloNix to our function parameter attributes,
use our version to set the tag and use our package for our command</p>
</aside>
</section>
<section id="building-again-with-our-package-now" class="slide level1">
<h1>Building again with our package now</h1>
<div class="sourceCode" id="cb70"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb70-1"><a href="#cb70-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker load <span class="op">&lt;</span> <span class="va">$(</span><span class="ex">nix</span> build .#dockerImage <span class="at">--no-link</span> <span class="at">--print-out-paths</span><span class="va">)</span></span>
<span id="cb70-2"><a href="#cb70-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Loaded</span> image: hello-nix:0.0.1</span>
<span id="cb70-3"><a href="#cb70-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run hello-nix</span>
<span id="cb70-4"><a href="#cb70-4" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> from nix!</span></code></pre></div>
<aside class="notes">
<p>Now we get our hello nix app when we load and run with docker</p>
</aside>
</section>
<section id="extending-our-docker-image-with-bash" class="slide level1">
<h1>Extending our docker image with bash</h1>
<div class="sourceCode" id="cb71"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb71-1"><a href="#cb71-1" aria-hidden="true" tabindex="-1"></a>pkgs<span class="op">.</span>dockerTools<span class="op">.</span>buildImage <span class="op">{</span></span>
<span id="cb71-2"><a href="#cb71-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">name</span> <span class="op">=</span> <span class="st">&quot;hello-nix&quot;</span><span class="op">;</span></span>
<span id="cb71-3"><a href="#cb71-3" aria-hidden="true" tabindex="-1"></a>  <span class="va">tag</span> <span class="op">=</span> helloNix<span class="op">.</span>version<span class="op">;</span></span>
<span id="cb71-4"><a href="#cb71-4" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb71-5"><a href="#cb71-5" aria-hidden="true" tabindex="-1"></a>  <span class="va">copyToRoot</span> <span class="op">=</span> pkgs<span class="op">.</span>buildEnv <span class="op">{</span></span>
<span id="cb71-6"><a href="#cb71-6" aria-hidden="true" tabindex="-1"></a>    <span class="va">name</span> <span class="op">=</span> <span class="st">&quot;image-root&quot;</span><span class="op">;</span></span>
<span id="cb71-7"><a href="#cb71-7" aria-hidden="true" tabindex="-1"></a>    <span class="va">paths</span> <span class="op">=</span> <span class="kw">with</span> pkgs<span class="op">;</span> <span class="op">[</span></span>
<span id="cb71-8"><a href="#cb71-8" aria-hidden="true" tabindex="-1"></a>      helloNix</span>
<span id="cb71-9"><a href="#cb71-9" aria-hidden="true" tabindex="-1"></a>      bashInteractive</span>
<span id="cb71-10"><a href="#cb71-10" aria-hidden="true" tabindex="-1"></a>      coreutils</span>
<span id="cb71-11"><a href="#cb71-11" aria-hidden="true" tabindex="-1"></a>    <span class="op">];</span></span>
<span id="cb71-12"><a href="#cb71-12" aria-hidden="true" tabindex="-1"></a>    <span class="va">pathsToLink</span> <span class="op">=</span> <span class="op">[</span> <span class="st">&quot;/bin&quot;</span> <span class="op">];</span></span>
<span id="cb71-13"><a href="#cb71-13" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb71-14"><a href="#cb71-14" aria-hidden="true" tabindex="-1"></a>  <span class="va">config</span> <span class="op">=</span> <span class="op">{</span></span>
<span id="cb71-15"><a href="#cb71-15" aria-hidden="true" tabindex="-1"></a>    <span class="va">Cmd</span> <span class="op">=</span> <span class="op">[</span> <span class="st">&quot;/bin/hello-nix&quot;</span> <span class="op">];</span></span>
<span id="cb71-16"><a href="#cb71-16" aria-hidden="true" tabindex="-1"></a>  <span class="op">};</span></span>
<span id="cb71-17"><a href="#cb71-17" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>Let’s make this a bit more robust. Let’s say we want to provide more
in our container, like having an interactive bash shell and common linux
utilities. We move to using the buildEnv, which takes a lisst of
packages, and a pathsToLink attribute which will symlink anything in our
packages’ /bin directory into the root’s /bin directory. This lets us
call /bin/hello-nix instead of our nix store path, but also puts bash
and everything else into bin as well.</p>
</aside>
</section>
<section id="extending-our-docker-image-with-bash-1"
class="slide level1">
<h1>Extending our docker image with bash</h1>
<div class="sourceCode" id="cb72"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb72-1"><a href="#cb72-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker load <span class="op">&lt;</span> <span class="va">$(</span><span class="ex">nix</span> build .#dockerImage <span class="at">--no-link</span> <span class="at">--print-out-paths</span><span class="va">)</span></span>
<span id="cb72-2"><a href="#cb72-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Loaded</span> image: hello-nix:0.0.1</span>
<span id="cb72-3"><a href="#cb72-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-it</span> /bin/bash</span>
<span id="cb72-4"><a href="#cb72-4" aria-hidden="true" tabindex="-1"></a><span class="ex">bash-5.2#</span></span></code></pre></div>
<aside class="notes">
<p>Now we have an interactive bash shell if we need it, or whatever
other packages we need at runtime.</p>
</aside>
</section>
<section id="adding-runtime-dependencies" class="slide level1">
<h1>Adding runtime dependencies</h1>
<p>Back to our <code>flake.nix</code></p>
<div class="sourceCode" id="cb73"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb73-1"><a href="#cb73-1" aria-hidden="true" tabindex="-1"></a>devShell = pkgs<span class="op">.</span>mkShell <span class="op">{</span></span>
<span id="cb73-2"><a href="#cb73-2" aria-hidden="true" tabindex="-1"></a>  <span class="va">buildInputs</span> <span class="op">=</span> <span class="kw">with</span> pkgs<span class="op">;</span> <span class="op">[</span></span>
<span id="cb73-3"><a href="#cb73-3" aria-hidden="true" tabindex="-1"></a>    cargo</span>
<span id="cb73-4"><a href="#cb73-4" aria-hidden="true" tabindex="-1"></a>    rustc</span>
<span id="cb73-5"><a href="#cb73-5" aria-hidden="true" tabindex="-1"></a>    rust-analyzer</span>
<span id="cb73-6"><a href="#cb73-6" aria-hidden="true" tabindex="-1"></a>    rustfmt</span>
<span id="cb73-7"><a href="#cb73-7" aria-hidden="true" tabindex="-1"></a>    figlet</span>
<span id="cb73-8"><a href="#cb73-8" aria-hidden="true" tabindex="-1"></a>    lolcat</span>
<span id="cb73-9"><a href="#cb73-9" aria-hidden="true" tabindex="-1"></a>  <span class="op">];</span></span>
<span id="cb73-10"><a href="#cb73-10" aria-hidden="true" tabindex="-1"></a><span class="op">}</span>;</span></code></pre></div>
<aside class="notes">
<p>Expanding on this further, let’s assume we have additional package
dependencies like figlet and lolcat. If you’re not familiar figlet turns
text into ascii text, and lolcat colorizes text. While figlet is written
in c, lolcat is written in ruby. Normally this would mean having to add
an entire language into your dev environment, maybe even versioning. But
nix can help us here since they are defined as packages.</p>
</aside>
</section>
<section id="testing-package-dependencies-for-development"
class="slide level1">
<h1>Testing package dependencies for development</h1>
<div class="sourceCode" id="cb74"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb74-1"><a href="#cb74-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cd hello-nix</span>
<span id="cb74-2"><a href="#cb74-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cargo run <span class="kw">|</span> <span class="ex">figlet</span> <span class="kw">|</span> <span class="ex">lolcat</span></span>
<span id="cb74-3"><a href="#cb74-3" aria-hidden="true" tabindex="-1"></a>    <span class="ex">Finished</span> <span class="kw">`</span><span class="ex">dev</span><span class="kw">`</span> profile [unoptimized + debuginfo] target<span class="er">(</span><span class="ex">s</span><span class="kw">)</span> <span class="er">in</span> <span class="ex">0.02s</span></span>
<span id="cb74-4"><a href="#cb74-4" aria-hidden="true" tabindex="-1"></a>     <span class="ex">Running</span> <span class="kw">`</span><span class="ex">target/debug/hello-nix</span><span class="kw">`</span></span>
<span id="cb74-5"><a href="#cb74-5" aria-hidden="true" tabindex="-1"></a> <span class="ex">_</span>   _      _ _          __                             _      _</span>
<span id="cb74-6"><a href="#cb74-6" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span><span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span>    / _<span class="kw">|</span><span class="ex">_</span> __ ___  _ __ ___    _ __ <span class="er">(</span><span class="ex">_</span><span class="kw">)</span><span class="ex">_</span>  _<span class="kw">|</span> <span class="kw">|</span></span>
<span id="cb74-7"><a href="#cb74-7" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="kw">|</span><span class="ex">_</span><span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\ </span><span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\ </span> <span class="kw">|</span> <span class="kw">|</span><span class="ex">_</span><span class="kw">|</span> <span class="st">&#39;__/ _ \| &#39;</span><span class="ex">_</span> <span class="kw">`</span> <span class="ex">_</span> <span class="dt">\ </span> <span class="kw">|</span> <span class="st">&#39;_ \| \ \/ / |</span></span>
<span id="cb74-8"><a href="#cb74-8" aria-hidden="true" tabindex="-1"></a><span class="st">|  _  |  __/ | | (_) | |  _| | | (_) | | | | | | | | | | |&gt;  &lt;|_|</span></span>
<span id="cb74-9"><a href="#cb74-9" aria-hidden="true" tabindex="-1"></a><span class="st">|_| |_|\___|_|_|\___/  |_| |_|  \___/|_| |_| |_| |_| |_|_/_/\_(_)</span></span></code></pre></div>
<aside class="notes">
<p>Once we direnv allow and our flake rebuilds, we can use these and we
get a more fun output. When we’re happy with testing this, we can move
to updating our rust program to run them all together by default.</p>
</aside>
</section>
<section id="using-makewrapper" class="slide level1">
<h1>Using makeWrapper</h1>
<div class="sourceCode" id="cb75"><pre
class="sourceCode nix"><code class="sourceCode nix"><span id="cb75-1"><a href="#cb75-1" aria-hidden="true" tabindex="-1"></a>pkgs<span class="op">.</span>rustPlatform<span class="op">.</span>buildRustPackage <span class="op">{</span></span>
<span id="cb75-2"><a href="#cb75-2" aria-hidden="true" tabindex="-1"></a>  <span class="co"># ...</span></span>
<span id="cb75-3"><a href="#cb75-3" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-4"><a href="#cb75-4" aria-hidden="true" tabindex="-1"></a>  <span class="va">nativeBuildInputs</span> <span class="op">=</span> <span class="op">[</span> pkgs<span class="op">.</span>makeWrapper <span class="op">];</span></span>
<span id="cb75-5"><a href="#cb75-5" aria-hidden="true" tabindex="-1"></a></span>
<span id="cb75-6"><a href="#cb75-6" aria-hidden="true" tabindex="-1"></a>  <span class="va">postInstall</span> <span class="op">=</span> <span class="st">&#39;&#39;</span></span>
<span id="cb75-7"><a href="#cb75-7" aria-hidden="true" tabindex="-1"></a><span class="st">    wrapProgram $out/bin/hello-nix \</span></span>
<span id="cb75-8"><a href="#cb75-8" aria-hidden="true" tabindex="-1"></a><span class="st">      --prefix PATH : </span><span class="sc">${</span>pkgs<span class="op">.</span>lolcat<span class="sc">}</span><span class="st">/bin \</span></span>
<span id="cb75-9"><a href="#cb75-9" aria-hidden="true" tabindex="-1"></a><span class="st">      --prefix PATH : </span><span class="sc">${</span>pkgs<span class="op">.</span>figlet<span class="sc">}</span><span class="st">/bin \</span></span>
<span id="cb75-10"><a href="#cb75-10" aria-hidden="true" tabindex="-1"></a><span class="st">      --add-flags &quot;| figlet | lolcat&quot;</span></span>
<span id="cb75-11"><a href="#cb75-11" aria-hidden="true" tabindex="-1"></a><span class="st">  &#39;&#39;</span><span class="op">;</span></span>
<span id="cb75-12"><a href="#cb75-12" aria-hidden="true" tabindex="-1"></a><span class="op">}</span></span></code></pre></div>
<aside class="notes">
<p>We can use a nix builtin package called makeWrapper to help us This
package has a set of bash functions, including wrapProgram which allows
us to re-wrap a binary in a bash script with some extra settings. In
this case we want to add lolcat and figet to our PATH, and add flags
every time our app is run. We use | figlet | lolcat to always run
hello-world with these arguments. There are more options available that
are just shown here.</p>
</aside>
</section>
<section id="using-makewrapper-1" class="slide level1">
<h1>Using makeWrapper</h1>
<div class="sourceCode" id="cb76"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb76-1"><a href="#cb76-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix build .#</span>
<span id="cb76-2"><a href="#cb76-2" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> cat result/bin/hello-nix</span>
<span id="cb76-3"><a href="#cb76-3" aria-hidden="true" tabindex="-1"></a><span class="co">#! /nix/store/xy4jjgw87sbgwylm5kn047d9gkbhsr9x-bash-5.2p37/bin/bash -e</span></span>
<span id="cb76-4"><a href="#cb76-4" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">:+</span><span class="st">&#39;:&#39;</span><span class="va">$PATH</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-5"><a href="#cb76-5" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">/</span><span class="st">&#39;:&#39;&#39;/nix/store/jjf7ym331wzp1jsyn05b7cscflk291bd-lolcat-100.0.1/bin&#39;&#39;:&#39;</span><span class="op">/</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-6"><a href="#cb76-6" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="st">&#39;/nix/store/jjf7ym331wzp1jsyn05b7cscflk291bd-lolcat-100.0.1/bin&#39;</span><span class="va">$PATH</span></span>
<span id="cb76-7"><a href="#cb76-7" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">#</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-8"><a href="#cb76-8" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">%</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-9"><a href="#cb76-9" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PATH</span></span>
<span id="cb76-10"><a href="#cb76-10" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">:+</span><span class="st">&#39;:&#39;</span><span class="va">$PATH</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-11"><a href="#cb76-11" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">/</span><span class="st">&#39;:&#39;&#39;/nix/store/q00xb5g6hv24yc7r6k3r6jws226vw8rm-figlet-2.2.5/bin&#39;&#39;:&#39;</span><span class="op">/</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-12"><a href="#cb76-12" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="st">&#39;/nix/store/q00xb5g6hv24yc7r6k3r6jws226vw8rm-figlet-2.2.5/bin&#39;</span><span class="va">$PATH</span></span>
<span id="cb76-13"><a href="#cb76-13" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">#</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-14"><a href="#cb76-14" aria-hidden="true" tabindex="-1"></a><span class="va">PATH</span><span class="op">=</span><span class="va">${PATH</span><span class="op">%</span><span class="st">&#39;:&#39;</span><span class="va">}</span></span>
<span id="cb76-15"><a href="#cb76-15" aria-hidden="true" tabindex="-1"></a><span class="bu">export</span> <span class="va">PATH</span></span>
<span id="cb76-16"><a href="#cb76-16" aria-hidden="true" tabindex="-1"></a><span class="bu">exec</span> <span class="st">&quot;/nix/store/jpfbhrzd6wpm607w1llyl52bs3dm074w-hello-nix-0.0.1/bin/.hello-nix-unwrapped&quot;</span>  <span class="kw">|</span> <span class="ex">figlet</span> <span class="kw">|</span> <span class="ex">lolcat</span> <span class="st">&quot;</span><span class="va">$@</span><span class="st">&quot;</span></span></code></pre></div>
<aside class="notes">
<p>If we build our app, we can see the bash it generates. Note that it’s
using everything from the nix store, even bash!</p>
</aside>
</section>
<section id="running-our-build" class="slide level1">
<h1>Running our build</h1>
<div class="sourceCode" id="cb77"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb77-1"><a href="#cb77-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> nix run .#</span>
<span id="cb77-2"><a href="#cb77-2" aria-hidden="true" tabindex="-1"></a> <span class="ex">_</span>   _      _ _          __                             _      _</span>
<span id="cb77-3"><a href="#cb77-3" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span><span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span>    / _<span class="kw">|</span><span class="ex">_</span> __ ___  _ __ ___    _ __ <span class="er">(</span><span class="ex">_</span><span class="kw">)</span><span class="ex">_</span>  _<span class="kw">|</span> <span class="kw">|</span></span>
<span id="cb77-4"><a href="#cb77-4" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="kw">|</span><span class="ex">_</span><span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\ </span><span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\ </span> <span class="kw">|</span> <span class="kw">|</span><span class="ex">_</span><span class="kw">|</span> <span class="st">&#39;__/ _ \| &#39;</span><span class="ex">_</span> <span class="kw">`</span> <span class="ex">_</span> <span class="dt">\ </span> <span class="kw">|</span> <span class="st">&#39;_ \| \ \/ / |</span></span>
<span id="cb77-5"><a href="#cb77-5" aria-hidden="true" tabindex="-1"></a><span class="st">|  _  |  __/ | | (_) | |  _| | | (_) | | | | | | | | | | |&gt;  &lt;|_|</span></span>
<span id="cb77-6"><a href="#cb77-6" aria-hidden="true" tabindex="-1"></a><span class="st">|_| |_|\___|_|_|\___/  |_| |_|  \___/|_| |_| |_| |_| |_|_/_/\_(_)</span></span></code></pre></div>
<aside class="notes">
<p>Running our package now from our flake gives us the formatted
hello</p>
</aside>
</section>
<section id="running-from-docker" class="slide level1">
<h1>Running from docker</h1>
<div class="sourceCode" id="cb78"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb78-1"><a href="#cb78-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker load <span class="op">&lt;</span> <span class="va">$(</span><span class="ex">nix</span> build .#dockerImage <span class="at">--no-link</span> <span class="at">--print-out-paths</span><span class="va">)</span></span>
<span id="cb78-2"><a href="#cb78-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Loaded</span> image: hello-nix:0.0.1</span>
<span id="cb78-3"><a href="#cb78-3" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-it</span> hello-nix:0.0.1</span>
<span id="cb78-4"><a href="#cb78-4" aria-hidden="true" tabindex="-1"></a> <span class="ex">_</span>   _      _ _          __                             _      _</span>
<span id="cb78-5"><a href="#cb78-5" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span><span class="kw">|</span> <span class="kw">|</span> <span class="kw">|</span> <span class="ex">___</span>    / _<span class="kw">|</span><span class="ex">_</span> __ ___  _ __ ___    _ __ <span class="er">(</span><span class="ex">_</span><span class="kw">)</span><span class="ex">_</span>  _<span class="kw">|</span> <span class="kw">|</span></span>
<span id="cb78-6"><a href="#cb78-6" aria-hidden="true" tabindex="-1"></a><span class="kw">|</span> <span class="kw">|</span><span class="ex">_</span><span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\ </span><span class="kw">|</span> <span class="kw">|</span><span class="ex">/</span> _ <span class="dt">\ </span> <span class="kw">|</span> <span class="kw">|</span><span class="ex">_</span><span class="kw">|</span> <span class="st">&#39;__/ _ \| &#39;</span><span class="ex">_</span> <span class="kw">`</span> <span class="ex">_</span> <span class="dt">\ </span> <span class="kw">|</span> <span class="st">&#39;_ \| \ \/ / |</span></span>
<span id="cb78-7"><a href="#cb78-7" aria-hidden="true" tabindex="-1"></a><span class="st">|  _  |  __/ | | (_) | |  _| | | (_) | | | | | | | | | | |&gt;  &lt;|_|</span></span>
<span id="cb78-8"><a href="#cb78-8" aria-hidden="true" tabindex="-1"></a><span class="st">|_| |_|\___|_|_|\___/  |_| |_|  \___/|_| |_| |_| |_| |_|_/_/\_(_)</span></span></code></pre></div>
<aside class="notes">
<p>And this automatically works in docker without any changes to our
docker build because we rely on our package build</p>
</aside>
</section>
<section id="running-the-unwrapped-version" class="slide level1">
<h1>Running the unwrapped version</h1>
<div class="sourceCode" id="cb79"><pre
class="sourceCode bash"><code class="sourceCode bash"><span id="cb79-1"><a href="#cb79-1" aria-hidden="true" tabindex="-1"></a><span class="ex">$</span> docker run <span class="at">-it</span> hello-nix:0.0.1 /bin/.hello-nix-wrapped</span>
<span id="cb79-2"><a href="#cb79-2" aria-hidden="true" tabindex="-1"></a><span class="ex">Hello</span> from nix!</span></code></pre></div>
<aside class="notes">
<p>The unwrapped version is still there if we ever need it And that’s it
- a single environment that lets to develop, build, and distribute your
app!</p>
</aside>
</section>
<section id="take-aways-and-jumping-off-points" class="slide level1">
<h1>Take-aways and jumping off points</h1>
<p>Now that you’ve gotten a quick tour of how nix can be helpful in
building out your dev environments, I encourage you to explore and learn
more.</p>
<p>Some jumping off points:</p>
<ul>
<li><a href="https://devenv.sh/">devenv</a> for pinning languages and
adding services (i.e. postgres, redis)</li>
<li><a
href="https://ryantm.github.io/nixpkgs/builders/images/dockertools/">dockertools</a>
for building containers with nix</li>
<li><a href="https://nixos.wiki/wiki/flakes">flakes</a> for more details
about building flakes</li>
<li><a
href="https://nixos.wiki/wiki/Nixpkgs/Create_and_debug_packages">nix
create and debug packages</a> to help build your own packages</li>
<li><a href="https://search.nixos.org/packages">search.nixos.org</a> to
explore packages</li>
<li><a href="https://zero-to-nix.com/">zero to nix</a> to learn more
about nix</li>
</ul>
<p>I hope this inspires you to learn more and experiment!</p>
<aside class="notes">
<p>I know this was a very quick tour, but I hope this gives you an idea
of what’s possible and how nix approaches this differently that what you
may have used in the past. There are just a few jumping off points for
learning more that I’ve found helpful</p>
</aside>
</section>
<section id="thank-you" class="slide level1">
<h1>Thank you!</h1>
<h2 id="repos-with-slides-and-code">Repos with slides and code</h2>
<ul>
<li><a
href="https://github.com/sentientmonkey/nix-talk">github/sentientmonkey/nix-talk</a></li>
<li><a
href="https://github.com/sentientmonkey/nix-first-steps">github/sentientmonkey/nix-first-steps</a></li>
<li><a
href="https://github.com/sentientmonkey/nix-config">github/sentientmonkey/nix-config</a></li>
</ul>
<h2 id="contact-info">Contact info</h2>
<ul>
<li><code>_swindsor</code> on PDX DevOps Discord</li>
<li><code>swindsor</code> at gmail for email</li>
<li><strong>sentientmonkey</strong> on github</li>
</ul>
<aside class="notes">
<p>Here’s some of my contact info if you want to follow up! A big thank
you for PDX DevOps for hosting and letting me share! A bit thank you to
you for sticking through this!</p>
</aside>
</section>
    </div>
  </div>

  <script src="https://unpkg.com/reveal.js/dist/reveal.js"></script>

  <!-- reveal.js plugins -->
  <script src="https://unpkg.com/reveal.js/plugin/notes/notes.js"></script>
  <script src="https://unpkg.com/reveal.js/plugin/search/search.js"></script>
  <script src="https://unpkg.com/reveal.js/plugin/zoom/zoom.js"></script>

  <script>

      // Full list of configuration options available at:
      // https://revealjs.com/config/
      Reveal.initialize({
        // Display controls in the bottom right corner
        controls: true,

        // Help the user learn the controls by providing hints, for example by
        // bouncing the down arrow when they first encounter a vertical slide
        controlsTutorial: true,

        // Determines where controls appear, "edges" or "bottom-right"
        controlsLayout: 'bottom-right',

        // Visibility rule for backwards navigation arrows; "faded", "hidden"
        // or "visible"
        controlsBackArrows: 'faded',

        // Display a presentation progress bar
        progress: true,

        // Display the page number of the current slide
        slideNumber: false,

        // 'all', 'print', or 'speaker'
        showSlideNumber: 'all',

        // Add the current slide number to the URL hash so that reloading the
        // page/copying the URL will return you to the same slide
        hash: true,

        // Start with 1 for the hash rather than 0
        hashOneBasedIndex: false,

        // Flags if we should monitor the hash and change slides accordingly
        respondToHashChanges: true,

        // Push each slide change to the browser history
        history: false,

        // Enable keyboard shortcuts for navigation
        keyboard: true,

        // Enable the slide overview mode
        overview: true,

        // Disables the default reveal.js slide layout (scaling and centering)
        // so that you can use custom CSS layout
        disableLayout: false,

        // Vertical centering of slides
        center: true,

        // Enables touch navigation on devices with touch input
        touch: true,

        // Loop the presentation
        loop: false,

        // Change the presentation direction to be RTL
        rtl: false,

        // see https://revealjs.com/vertical-slides/#navigation-mode
        navigationMode: 'default',

        // Randomizes the order of slides each time the presentation loads
        shuffle: false,

        // Turns fragments on and off globally
        fragments: true,

        // Flags whether to include the current fragment in the URL,
        // so that reloading brings you to the same fragment position
        fragmentInURL: true,

        // Flags if the presentation is running in an embedded mode,
        // i.e. contained within a limited portion of the screen
        embedded: false,

        // Flags if we should show a help overlay when the questionmark
        // key is pressed
        help: true,

        // Flags if it should be possible to pause the presentation (blackout)
        pause: true,

        // Flags if speaker notes should be visible to all viewers
        showNotes: false,

        // Global override for autoplaying embedded media (null/true/false)
        autoPlayMedia: null,

        // Global override for preloading lazy-loaded iframes (null/true/false)
        preloadIframes: null,

        // Number of milliseconds between automatically proceeding to the
        // next slide, disabled when set to 0, this value can be overwritten
        // by using a data-autoslide attribute on your slides
        autoSlide: 0,

        // Stop auto-sliding after user input
        autoSlideStoppable: true,

        // Use this method for navigation when auto-sliding
        autoSlideMethod: null,

        // Specify the average time in seconds that you think you will spend
        // presenting each slide. This is used to show a pacing timer in the
        // speaker view
        defaultTiming: null,

        // Enable slide navigation via mouse wheel
        mouseWheel: false,

        // The display mode that will be used to show slides
        display: 'block',

        // Hide cursor if inactive
        hideInactiveCursor: true,

        // Time before the cursor is hidden (in ms)
        hideCursorTime: 5000,

        // Opens links in an iframe preview overlay
        previewLinks: false,

        // Transition style (none/fade/slide/convex/concave/zoom)
        transition: 'slide',

        // Transition speed (default/fast/slow)
        transitionSpeed: 'default',

        // Transition style for full page slide backgrounds
        // (none/fade/slide/convex/concave/zoom)
        backgroundTransition: 'fade',

        // Number of slides away from the current that are visible
        viewDistance: 3,

        // Number of slides away from the current that are visible on mobile
        // devices. It is advisable to set this to a lower number than
        // viewDistance in order to save resources.
        mobileViewDistance: 2,

        // reveal.js plugins
        plugins: [
          RevealNotes,
          RevealSearch,
          RevealZoom
        ]
      });
    </script>
    </body>
</html>
